import{c as ge,H as D,j as r,r as C,e as ks,X as Ze,f as Fr,M as js,T as Or,B as Xe,h as Nt,S as Ut,i as nt,L as pr,d as Ns,k as it,V as Ke,C as Ss}from"./index-0edf21a1.js";import{F as Le}from"./file-text-42117152.js";import{B as Bt,U as Cs,A as Ts,a as Is,S as Hs}from"./user-eb17ae2e.js";import{M as Rs}from"./more-vertical-adbb54c4.js";const zt=ge("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),zs=ge("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]),Gt=ge("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),rt=ge("Files",[["path",{d:"M15.5 2H8.6c-.4 0-.8.2-1.1.5-.3.3-.5.7-.5 1.1v12.8c0 .4.2.8.5 1.1.3.3.7.5 1.1.5h9.8c.4 0 .8-.2 1.1-.5.3-.3.5-.7.5-1.1V6.5L15.5 2z",key:"cennsq"}],["path",{d:"M3 7.6v12.8c0 .4.2.8.5 1.1.3.3.7.5 1.1.5h9.8",key:"ms809a"}],["path",{d:"M15 2v5h5",key:"qq6kwv"}]]),Vr=ge("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]),Es=ge("Headphones",[["path",{d:"M3 14h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7a9 9 0 0 1 18 0v7a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3",key:"1xhozi"}]]),Qt=ge("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),_t=ge("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),Ls=ge("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]),yr=ge("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]),Ms=ge("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]),As=ge("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),St=ge("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),Ws=ge("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),Ds=ge("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),Bs=ge("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),Ps=ge("SkipBack",[["polygon",{points:"19 20 9 12 19 4 19 20",key:"o2sva"}],["line",{x1:"5",x2:"5",y1:"19",y2:"5",key:"1ocqjk"}]]),Fs=ge("SkipForward",[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]]),st=ge("StickyNote",[["path",{d:"M15.5 3H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2V8.5L15.5 3Z",key:"1wis1t"}],["path",{d:"M15 3v6h6",key:"edgan2"}]]),Ct=ge("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]),qt=ge("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),Et=0,Be=1,Qe=2,$r=4;function br(e){return()=>e}function Os(e){e()}function Ur(e,t){return s=>e(t(s))}function vr(e,t){return()=>e(t)}function Vs(e,t){return s=>e(t,s)}function er(e){return e!==void 0}function $s(...e){return()=>{e.map(Os)}}function ht(){}function Lt(e,t){return t(e),e}function Us(e,t){return t(e)}function le(...e){return e}function Q(e,t){return e(Be,t)}function G(e,t){e(Et,t)}function tr(e){e(Qe)}function me(e){return e($r)}function P(e,t){return Q(e,Vs(t,Et))}function ze(e,t){const s=e(Be,n=>{s(),t(n)});return s}function wr(e){let t,s;return n=>o=>{t=o,s&&clearTimeout(s),s=setTimeout(()=>{n(t)},e)}}function Gr(e,t){return e===t}function ie(e=Gr){let t;return s=>n=>{e(t,n)||(t=n,s(n))}}function V(e){return t=>s=>{e(s)&&t(s)}}function W(e){return t=>Ur(t,e)}function He(e){return t=>()=>{t(e)}}function T(e,...t){const s=Gs(...t);return(n,o)=>{switch(n){case Qe:tr(e);return;case Be:return Q(e,s(o))}}}function Re(e,t){return s=>n=>{s(t=e(t,n))}}function Je(e){return t=>s=>{e>0?e--:t(s)}}function We(e){let t=null,s;return n=>o=>{t=o,!s&&(s=setTimeout(()=>{s=void 0,n(t)},e))}}function _(...e){const t=new Array(e.length);let s=0,n=null;const o=Math.pow(2,e.length)-1;return e.forEach((a,l)=>{const i=Math.pow(2,l);Q(a,c=>{const h=s;s=s|i,t[l]=c,h!==o&&s===o&&n&&(n(),n=null)})}),a=>l=>{const i=()=>{a([l].concat(t))};s===o?i():n=i}}function Gs(...e){return t=>e.reduceRight(Us,t)}function _s(e){let t,s;const n=()=>t==null?void 0:t();return function(o,a){switch(o){case Be:return a?s===a?void 0:(n(),s=a,t=Q(e,a),t):(n(),ht);case Qe:n(),s=null;return}}}function z(e){let t=e;const s=Y();return(n,o)=>{switch(n){case Et:t=o;break;case Be:{o(t);break}case $r:return t}return s(n,o)}}function ye(e,t){return Lt(z(t),s=>P(e,s))}function Y(){const e=[];return(t,s)=>{switch(t){case Et:e.slice().forEach(n=>{n(s)});return;case Qe:e.splice(0,e.length);return;case Be:return e.push(s),()=>{const n=e.indexOf(s);n>-1&&e.splice(n,1)}}}}function ke(e){return Lt(Y(),t=>P(e,t))}function ee(e,t=[],{singleton:s}={singleton:!0}){return{constructor:e,dependencies:t,id:qs(),singleton:s}}const qs=()=>Symbol();function Ks(e){const t=new Map,s=({constructor:n,dependencies:o,id:a,singleton:l})=>{if(l&&t.has(a))return t.get(a);const i=n(o.map(c=>s(c)));return l&&t.set(a,i),i};return s(e)}function xe(...e){const t=Y(),s=new Array(e.length);let n=0;const o=Math.pow(2,e.length)-1;return e.forEach((a,l)=>{const i=Math.pow(2,l);Q(a,c=>{s[l]=c,n=n|i,n===o&&G(t,s)})}),function(a,l){switch(a){case Qe:{tr(t);return}case Be:return n===o&&l(s),Q(t,l)}}}function $(e,t=Gr){return T(e,ie(t))}function kr(...e){return function(t,s){switch(t){case Qe:return;case Be:return $s(...e.map(n=>Q(n,s)))}}}var ve=(e=>(e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR",e))(ve||{});const Ys={0:"debug",3:"error",1:"log",2:"warn"},Zs=()=>typeof globalThis>"u"?window:globalThis,Pe=ee(()=>{const e=z(3);return{log:z((t,s,n=1)=>{var o;const a=(o=Zs().VIRTUOSO_LOG_LEVEL)!=null?o:me(e);n>=a&&console[Ys[n]]("%creact-virtuoso: %c%s %o","color: #0253b3; font-weight: bold","color: initial",t,s)}),logLevel:e}},[],{singleton:!0});function Ue(e,t,s){return rr(e,t,s).callbackRef}function rr(e,t,s){const n=D.useRef(null);let o=l=>{};const a=D.useMemo(()=>typeof ResizeObserver<"u"?new ResizeObserver(l=>{const i=()=>{const c=l[0].target;c.offsetParent!==null&&e(c)};s?i():requestAnimationFrame(i)}):null,[e,s]);return o=l=>{l&&t?(a==null||a.observe(l),n.current=l):(n.current&&(a==null||a.unobserve(n.current)),n.current=null)},{callbackRef:o,ref:n}}function Xs(e,t,s,n,o,a,l,i,c){const h=D.useCallback(y=>{const k=Js(y.children,t,i?"offsetWidth":"offsetHeight",o);let f=y.parentElement;for(;!f.dataset.virtuosoScroller;)f=f.parentElement;const p=f.lastElementChild.dataset.viewportType==="window";let w;p&&(w=f.ownerDocument.defaultView);const m=l?i?l.scrollLeft:l.scrollTop:p?i?w.scrollX||w.document.documentElement.scrollLeft:w.scrollY||w.document.documentElement.scrollTop:i?f.scrollLeft:f.scrollTop,g=l?i?l.scrollWidth:l.scrollHeight:p?i?w.document.documentElement.scrollWidth:w.document.documentElement.scrollHeight:i?f.scrollWidth:f.scrollHeight,d=l?i?l.offsetWidth:l.offsetHeight:p?i?w.innerWidth:w.innerHeight:i?f.offsetWidth:f.offsetHeight;n({scrollHeight:g,scrollTop:Math.max(m,0),viewportHeight:d}),a==null||a(i?jr("column-gap",getComputedStyle(y).columnGap,o):jr("row-gap",getComputedStyle(y).rowGap,o)),k!==null&&e(k)},[e,t,o,a,l,n,i]);return rr(h,s,c)}function Js(e,t,s,n){const o=e.length;if(o===0)return null;const a=[];for(let l=0;l<o;l++){const i=e.item(l);if(i.dataset.index===void 0)continue;const c=parseInt(i.dataset.index),h=parseFloat(i.dataset.knownSize),y=t(i,s);if(y===0&&n("Zero-sized element, this should not happen",{child:i},ve.ERROR),y===h)continue;const k=a[a.length-1];a.length===0||k.size!==y||k.endIndex!==c-1?a.push({endIndex:c,size:y,startIndex:c}):a[a.length-1].endIndex++}return a}function jr(e,t,s){return t!=="normal"&&!(t!=null&&t.endsWith("px"))&&s(`${e} was not resolved to pixel value correctly`,t,ve.WARN),t==="normal"?0:parseInt(t??"0",10)}function _r(e,t,s){const n=D.useRef(null),o=D.useCallback(c=>{if(!(c!=null&&c.offsetParent))return;const h=c.getBoundingClientRect(),y=h.width;let k,f;if(t){const p=t.getBoundingClientRect(),w=h.top-p.top;f=p.height-Math.max(0,w),k=w+t.scrollTop}else{const p=l.current.ownerDocument.defaultView;f=p.innerHeight-Math.max(0,h.top),k=h.top+p.scrollY}n.current={offsetTop:k,visibleHeight:f,visibleWidth:y},e(n.current)},[e,t]),{callbackRef:a,ref:l}=rr(o,!0,s),i=D.useCallback(()=>{o(l.current)},[o,l]);return D.useEffect(()=>{var c;if(t){t.addEventListener("scroll",i);const h=new ResizeObserver(()=>{requestAnimationFrame(i)});return h.observe(t),()=>{t.removeEventListener("scroll",i),h.unobserve(t)}}else{const h=(c=l.current)==null?void 0:c.ownerDocument.defaultView;return h==null||h.addEventListener("scroll",i),h==null||h.addEventListener("resize",i),()=>{h==null||h.removeEventListener("scroll",i),h==null||h.removeEventListener("resize",i)}}},[i,t,l]),a}const be=ee(()=>{const e=Y(),t=Y(),s=z(0),n=Y(),o=z(0),a=Y(),l=Y(),i=z(0),c=z(0),h=z(0),y=z(0),k=Y(),f=Y(),p=z(!1),w=z(!1),m=z(!1);return P(T(e,W(({scrollTop:g})=>g)),t),P(T(e,W(({scrollHeight:g})=>g)),l),P(t,o),{deviation:s,fixedFooterHeight:h,fixedHeaderHeight:c,footerHeight:y,headerHeight:i,horizontalDirection:w,scrollBy:f,scrollContainerState:e,scrollHeight:l,scrollingInProgress:p,scrollTo:k,scrollTop:t,skipAnimationFrameInResizeObserver:m,smoothScrollTargetReached:n,statefulScrollTop:o,viewportHeight:a}},[],{singleton:!0}),lt={lvl:0};function qr(e,t){const s=e.length;if(s===0)return[];let{index:n,value:o}=t(e[0]);const a=[];for(let l=1;l<s;l++){const{index:i,value:c}=t(e[l]);a.push({end:i-1,start:n,value:o}),n=i,o=c}return a.push({end:1/0,start:n,value:o}),a}function se(e){return e===lt}function ct(e,t){if(!se(e))return t===e.k?e.v:t<e.k?ct(e.l,t):ct(e.r,t)}function Te(e,t,s="k"){if(se(e))return[-1/0,void 0];if(Number(e[s])===t)return[e.k,e.v];if(Number(e[s])<t){const n=Te(e.r,t,s);return n[0]===-1/0?[e.k,e.v]:n}return Te(e.l,t,s)}function we(e,t,s){return se(e)?Zr(t,s,1):t===e.k?he(e,{k:t,v:s}):t<e.k?Nr(he(e,{l:we(e.l,t,s)})):Nr(he(e,{r:we(e.r,t,s)}))}function Ye(){return lt}function Mt(e,t,s){if(se(e))return[];const n=Te(e,t)[0];return Qs(Yt(e,n,s))}function Kt(e,t){if(se(e))return lt;const{k:s,l:n,r:o}=e;if(t===s){if(se(n))return o;if(se(o))return n;{const[a,l]=Yr(n);return kt(he(e,{k:a,l:Kr(n),v:l}))}}else return t<s?kt(he(e,{l:Kt(n,t)})):kt(he(e,{r:Kt(o,t)}))}function $e(e){return se(e)?[]:[...$e(e.l),{k:e.k,v:e.v},...$e(e.r)]}function Yt(e,t,s){if(se(e))return[];const{k:n,l:o,r:a,v:l}=e;let i=[];return n>t&&(i=i.concat(Yt(o,t,s))),n>=t&&n<=s&&i.push({k:n,v:l}),n<=s&&(i=i.concat(Yt(a,t,s))),i}function kt(e){const{l:t,lvl:s,r:n}=e;if(n.lvl>=s-1&&t.lvl>=s-1)return e;if(s>n.lvl+1){if(Pt(t))return Xr(he(e,{lvl:s-1}));if(!se(t)&&!se(t.r))return he(t.r,{l:he(t,{r:t.r.l}),lvl:s,r:he(e,{l:t.r.r,lvl:s-1})});throw new Error("Unexpected empty nodes")}else{if(Pt(e))return Zt(he(e,{lvl:s-1}));if(!se(n)&&!se(n.l)){const o=n.l,a=Pt(o)?n.lvl-1:n.lvl;return he(o,{l:he(e,{lvl:s-1,r:o.l}),lvl:o.lvl+1,r:Zt(he(n,{l:o.r,lvl:a}))})}else throw new Error("Unexpected empty nodes")}}function he(e,t){return Zr(t.k!==void 0?t.k:e.k,t.v!==void 0?t.v:e.v,t.lvl!==void 0?t.lvl:e.lvl,t.l!==void 0?t.l:e.l,t.r!==void 0?t.r:e.r)}function Kr(e){return se(e.r)?e.l:kt(he(e,{r:Kr(e.r)}))}function Pt(e){return se(e)||e.lvl>e.r.lvl}function Yr(e){return se(e.r)?[e.k,e.v]:Yr(e.r)}function Zr(e,t,s,n=lt,o=lt){return{k:e,l:n,lvl:s,r:o,v:t}}function Nr(e){return Zt(Xr(e))}function Xr(e){const{l:t}=e;return!se(t)&&t.lvl===e.lvl?he(t,{r:he(e,{l:t.r})}):e}function Zt(e){const{lvl:t,r:s}=e;return!se(s)&&!se(s.r)&&s.lvl===t&&s.r.lvl===t?he(s,{l:he(e,{r:s.l}),lvl:t+1}):e}function Qs(e){return qr(e,({k:t,v:s})=>({index:t,value:s}))}function Jr(e,t){return!!(e&&e.startIndex===t.startIndex&&e.endIndex===t.endIndex)}function dt(e,t){return!!(e&&e[0]===t[0]&&e[1]===t[1])}const sr=ee(()=>({recalcInProgress:z(!1)}),[],{singleton:!0});function Qr(e,t,s){return e[Tt(e,t,s)]}function Tt(e,t,s,n=0){let o=e.length-1;for(;n<=o;){const a=Math.floor((n+o)/2),l=e[a],i=s(l,t);if(i===0)return a;if(i===-1){if(o-n<2)return a-1;o=a-1}else{if(o===n)return a;n=a+1}}throw new Error(`Failed binary finding record in array - ${e.join(",")}, searched for ${t}`)}function en(e,t,s,n){const o=Tt(e,t,n),a=Tt(e,s,n,o);return e.slice(o,a+1)}function De(e,t){return Math.round(e.getBoundingClientRect()[t])}function At(e){return!se(e.groupOffsetTree)}function nr({index:e},t){return t===e?0:t<e?-1:1}function tn(){return{groupIndices:[],groupOffsetTree:Ye(),lastIndex:0,lastOffset:0,lastSize:0,offsetTree:[],sizeTree:Ye()}}function rn(e,t){let s=se(e)?0:1/0;for(const n of t){const{endIndex:o,size:a,startIndex:l}=n;if(s=Math.min(s,l),se(e)){e=we(e,0,a);continue}const i=Mt(e,l-1,o+1);if(i.some(dn(n)))continue;let c=!1,h=!1;for(const{end:y,start:k,value:f}of i)c?(o>=k||a===f)&&(e=Kt(e,k)):(h=f!==a,c=!0),y>o&&o>=k&&f!==a&&(e=we(e,o+1,f));h&&(e=we(e,l,a))}return[e,s]}function sn(e){return typeof e.groupIndex<"u"}function nn({offset:e},t){return t===e?0:t<e?-1:1}function gt(e,t,s){if(t.length===0)return 0;const{index:n,offset:o,size:a}=Qr(t,e,nr),l=e-n,i=a*l+(l-1)*s+o;return i>0?i+s:i}function es(e,t){if(!At(t))return e;let s=0;for(;t.groupIndices[s]<=e+s;)s++;return e+s}function ts(e,t,s){if(sn(e))return t.groupIndices[e.groupIndex]+1;{const n=e.index==="LAST"?s:e.index;let o=es(n,t);return o=Math.max(0,o,Math.min(s,o)),o}}function on(e,t,s,n=0){return n>0&&(t=Math.max(t,Qr(e,n,nr).offset)),qr(en(e,t,s,nn),cn)}function an(e,[t,s,n,o]){t.length>0&&n("received item sizes",t,ve.DEBUG);const a=e.sizeTree;let l=a,i=0;if(s.length>0&&se(a)&&t.length===2){const f=t[0].size,p=t[1].size;l=s.reduce((w,m)=>we(we(w,m,f),m+1,p),l)}else[l,i]=rn(l,t);if(l===a)return e;const{lastIndex:c,lastOffset:h,lastSize:y,offsetTree:k}=Xt(e.offsetTree,i,l,o);return{groupIndices:s,groupOffsetTree:s.reduce((f,p)=>we(f,p,gt(p,k,o)),Ye()),lastIndex:c,lastOffset:h,lastSize:y,offsetTree:k,sizeTree:l}}function ln(e){return $e(e).map(({k:t,v:s},n,o)=>{const a=o[n+1];return{endIndex:a?a.k-1:1/0,size:s,startIndex:t}})}function Sr(e,t){let s=0,n=0;for(;s<e;)s+=t[n+1]-t[n]-1,n++;return n-(s===e?0:1)}function Xt(e,t,s,n){let o=e,a=0,l=0,i=0,c=0;if(t!==0){c=Tt(o,t-1,nr),i=o[c].offset;const h=Te(s,t-1);a=h[0],l=h[1],o.length&&o[c].size===Te(s,t)[1]&&(c-=1),o=o.slice(0,c+1)}else o=[];for(const{start:h,value:y}of Mt(s,t,1/0)){const k=h-a,f=k*l+i+k*n;o.push({index:h,offset:f,size:y}),a=h,i=f,l=y}return{lastIndex:a,lastOffset:i,lastSize:l,offsetTree:o}}function cn(e){return{index:e.index,value:e}}function dn(e){const{endIndex:t,size:s,startIndex:n}=e;return o=>o.start===n&&(o.end===t||o.end===1/0)&&o.value===s}const gn={offsetHeight:"height",offsetWidth:"width"},Ee=ee(([{log:e},{recalcInProgress:t}])=>{const s=Y(),n=Y(),o=ye(n,0),a=Y(),l=Y(),i=z(0),c=z([]),h=z(void 0),y=z(void 0),k=z((v,x)=>De(v,gn[x])),f=z(void 0),p=z(0),w=tn(),m=ye(T(s,_(c,e,p),Re(an,w),ie()),w),g=ye(T(c,ie(),Re((v,x)=>({current:x,prev:v.current}),{current:[],prev:[]}),W(({prev:v})=>v)),[]);P(T(c,V(v=>v.length>0),_(m,p),W(([v,x,j])=>{const H=v.reduce((L,b,R)=>we(L,b,gt(b,x.offsetTree,j)||R),Ye());return{...x,groupIndices:v,groupOffsetTree:H}})),m),P(T(n,_(m),V(([v,{lastIndex:x}])=>v<x),W(([v,{lastIndex:x,lastSize:j}])=>[{endIndex:x,size:j,startIndex:v}])),s),P(h,y);const d=ye(T(h,W(v=>v===void 0)),!0);P(T(y,V(v=>v!==void 0&&se(me(m).sizeTree)),W(v=>[{endIndex:0,size:v,startIndex:0}])),s);const u=ke(T(s,_(m),Re(({sizes:v},[x,j])=>({changed:j!==v,sizes:j}),{changed:!1,sizes:w}),W(v=>v.changed)));Q(T(i,Re((v,x)=>({diff:v.prev-x,prev:x}),{diff:0,prev:0}),W(v=>v.diff)),v=>{const{groupIndices:x}=me(m);if(v>0)G(t,!0),G(a,v+Sr(v,x));else if(v<0){const j=me(g);j.length>0&&(v-=Sr(-v,j)),G(l,v)}}),Q(T(i,_(e)),([v,x])=>{v<0&&x("`firstItemIndex` prop should not be set to less than zero. If you don't know the total count, just use a very high value",{firstItemIndex:i},ve.ERROR)});const N=ke(a);P(T(a,_(m),W(([v,x])=>{const j=x.groupIndices.length>0,H=[],L=x.lastSize;if(j){const b=ct(x.sizeTree,0);let R=0,F=0;for(;R<v;){const A=x.groupIndices[F],E=x.groupIndices.length===F+1?1/0:x.groupIndices[F+1]-A-1;H.push({endIndex:A,size:b,startIndex:A}),H.push({endIndex:A+1+E-1,size:L,startIndex:A+1}),F++,R+=E+1}const K=$e(x.sizeTree);return R!==v&&K.shift(),K.reduce((A,{k:E,v:O})=>{let X=A.ranges;return A.prevSize!==0&&(X=[...A.ranges,{endIndex:E+v-1,size:A.prevSize,startIndex:A.prevIndex}]),{prevIndex:E+v,prevSize:O,ranges:X}},{prevIndex:v,prevSize:0,ranges:H}).ranges}return $e(x.sizeTree).reduce((b,{k:R,v:F})=>({prevIndex:R+v,prevSize:F,ranges:[...b.ranges,{endIndex:R+v-1,size:b.prevSize,startIndex:b.prevIndex}]}),{prevIndex:0,prevSize:L,ranges:[]}).ranges})),s);const S=ke(T(l,_(m,p),W(([v,{offsetTree:x},j])=>{const H=-v;return gt(H,x,j)})));return P(T(l,_(m,p),W(([v,x,j])=>{if(x.groupIndices.length>0){if(se(x.sizeTree))return x;let H=Ye();const L=me(g);let b=0,R=0,F=0;for(;b<-v;){F=L[R];const K=L[R+1]-F-1;R++,b+=K+1}if(H=$e(x.sizeTree).reduce((K,{k:A,v:E})=>we(K,Math.max(0,A+v),E),H),b!==-v){const K=ct(x.sizeTree,F);H=we(H,0,K);const A=Te(x.sizeTree,-v+1)[1];H=we(H,1,A)}return{...x,sizeTree:H,...Xt(x.offsetTree,0,H,j)}}else{const H=$e(x.sizeTree).reduce((L,{k:b,v:R})=>we(L,Math.max(0,b+v),R),Ye());return{...x,sizeTree:H,...Xt(x.offsetTree,0,H,j)}}})),m),{beforeUnshiftWith:N,data:f,defaultItemSize:y,firstItemIndex:i,fixedItemSize:h,gap:p,groupIndices:c,itemSize:k,listRefresh:u,shiftWith:l,shiftWithOffset:S,sizeRanges:s,sizes:m,statefulTotalCount:o,totalCount:n,trackItemSizes:d,unshiftWith:a}},le(Pe,sr),{singleton:!0});function un(e){return e.reduce((t,s)=>(t.groupIndices.push(t.totalCount),t.totalCount+=s+1,t),{groupIndices:[],totalCount:0})}const rs=ee(([{groupIndices:e,sizes:t,totalCount:s},{headerHeight:n,scrollTop:o}])=>{const a=Y(),l=Y(),i=ke(T(a,W(un)));return P(T(i,W(c=>c.totalCount)),s),P(T(i,W(c=>c.groupIndices)),e),P(T(xe(o,t,n),V(([c,h])=>At(h)),W(([c,h,y])=>Te(h.groupOffsetTree,Math.max(c-y,0),"v")[0]),ie(),W(c=>[c])),l),{groupCounts:a,topItemsIndexes:l}},le(Ee,be)),Fe=ee(([{log:e}])=>{const t=z(!1),s=ke(T(t,V(n=>n),ie()));return Q(t,n=>{n&&me(e)("props updated",{},ve.DEBUG)}),{didMount:s,propsReady:t}},le(Pe),{singleton:!0}),hn=typeof document<"u"&&"scrollBehavior"in document.documentElement.style;function ss(e){const t=typeof e=="number"?{index:e}:e;return t.align||(t.align="start"),(!t.behavior||!hn)&&(t.behavior="auto"),t.offset||(t.offset=0),t}const xt=ee(([{gap:e,listRefresh:t,sizes:s,totalCount:n},{fixedFooterHeight:o,fixedHeaderHeight:a,footerHeight:l,headerHeight:i,scrollingInProgress:c,scrollTo:h,smoothScrollTargetReached:y,viewportHeight:k},{log:f}])=>{const p=Y(),w=Y(),m=z(0);let g=null,d=null,u=null;function N(){g&&(g(),g=null),u&&(u(),u=null),d&&(clearTimeout(d),d=null),G(c,!1)}return P(T(p,_(s,k,n,m,i,l,f),_(e,a,o),W(([[S,v,x,j,H,L,b,R],F,K,A])=>{const E=ss(S),{align:O,behavior:X,offset:ne}=E,ce=j-1,ue=ts(E,v,ce);let B=gt(ue,v.offsetTree,F)+L;O==="end"?(B+=K+Te(v.sizeTree,ue)[1]-x+A,ue===ce&&(B+=b)):O==="center"?B+=(K+Te(v.sizeTree,ue)[1]-x+A)/2:B-=H,ne&&(B+=ne);const J=te=>{N(),te?(R("retrying to scroll to",{location:S},ve.DEBUG),G(p,S)):(G(w,!0),R("list did not change, scroll successful",{},ve.DEBUG))};if(N(),X==="smooth"){let te=!1;u=Q(t,je=>{te=te||je}),g=ze(y,()=>{J(te)})}else g=ze(T(t,xn(150)),J);return d=setTimeout(()=>{N()},1200),G(c,!0),R("scrolling from index to",{behavior:X,index:ue,top:B},ve.DEBUG),{behavior:X,top:B}})),h),{scrollTargetReached:w,scrollToIndex:p,topListHeight:m}},le(Ee,be,Pe),{singleton:!0});function xn(e){return t=>{const s=setTimeout(()=>{t(!1)},e);return n=>{n&&(t(!0),clearTimeout(s))}}}function or(e,t){e==0?t():requestAnimationFrame(()=>{or(e-1,t)})}function ar(e,t){const s=t-1;return typeof e=="number"?e:e.index==="LAST"?s:e.index}const mt=ee(([{defaultItemSize:e,listRefresh:t,sizes:s},{scrollTop:n},{scrollTargetReached:o,scrollToIndex:a},{didMount:l}])=>{const i=z(!0),c=z(0),h=z(!0);return P(T(l,_(c),V(([y,k])=>!!k),He(!1)),i),P(T(l,_(c),V(([y,k])=>!!k),He(!1)),h),Q(T(xe(t,l),_(i,s,e,h),V(([[,y],k,{sizeTree:f},p,w])=>y&&(!se(f)||er(p))&&!k&&!w),_(c)),([,y])=>{ze(o,()=>{G(h,!0)}),or(4,()=>{ze(n,()=>{G(i,!0)}),G(a,y)})}),{initialItemFinalLocationReached:h,initialTopMostItemIndex:c,scrolledToInitialItem:i}},le(Ee,be,xt,Fe),{singleton:!0});function ns(e,t){return Math.abs(e-t)<1.01}const ut="up",ot="down",mn="none",fn={atBottom:!1,notAtBottomBecause:"NOT_SHOWING_LAST_ITEM",state:{offsetBottom:0,scrollHeight:0,scrollTop:0,viewportHeight:0}},pn=0,ft=ee(([{footerHeight:e,headerHeight:t,scrollBy:s,scrollContainerState:n,scrollTop:o,viewportHeight:a}])=>{const l=z(!1),i=z(!0),c=Y(),h=Y(),y=z(4),k=z(pn),f=ye(T(kr(T($(o),Je(1),He(!0)),T($(o),Je(1),He(!1),wr(100))),ie()),!1),p=ye(T(kr(T(s,He(!0)),T(s,He(!1),wr(200))),ie()),!1);P(T(xe($(o),$(k)),W(([u,N])=>u<=N),ie()),i),P(T(i,We(50)),h);const w=ke(T(xe(n,$(a),$(t),$(e),$(y)),Re((u,[{scrollHeight:N,scrollTop:S},v,x,j,H])=>{const L=S+v-N>-H,b={scrollHeight:N,scrollTop:S,viewportHeight:v};if(L){let F,K;return S>u.state.scrollTop?(F="SCROLLED_DOWN",K=u.state.scrollTop-S):(F="SIZE_DECREASED",K=u.state.scrollTop-S||u.scrollTopDelta),{atBottom:!0,atBottomBecause:F,scrollTopDelta:K,state:b}}let R;return b.scrollHeight>u.state.scrollHeight?R="SIZE_INCREASED":v<u.state.viewportHeight?R="VIEWPORT_HEIGHT_DECREASING":S<u.state.scrollTop?R="SCROLLING_UPWARDS":R="NOT_FULLY_SCROLLED_TO_LAST_ITEM_BOTTOM",{atBottom:!1,notAtBottomBecause:R,state:b}},fn),ie((u,N)=>u&&u.atBottom===N.atBottom))),m=ye(T(n,Re((u,{scrollHeight:N,scrollTop:S,viewportHeight:v})=>{if(ns(u.scrollHeight,N))return{changed:!1,jump:0,scrollHeight:N,scrollTop:S};{const x=N-(S+v)<1;return u.scrollTop!==S&&x?{changed:!0,jump:u.scrollTop-S,scrollHeight:N,scrollTop:S}:{changed:!0,jump:0,scrollHeight:N,scrollTop:S}}},{changed:!1,jump:0,scrollHeight:0,scrollTop:0}),V(u=>u.changed),W(u=>u.jump)),0);P(T(w,W(u=>u.atBottom)),l),P(T(l,We(50)),c);const g=z(ot);P(T(n,W(({scrollTop:u})=>u),ie(),Re((u,N)=>me(p)?{direction:u.direction,prevScrollTop:N}:{direction:N<u.prevScrollTop?ut:ot,prevScrollTop:N},{direction:ot,prevScrollTop:0}),W(u=>u.direction)),g),P(T(n,We(50),He(mn)),g);const d=z(0);return P(T(f,V(u=>!u),He(0)),d),P(T(o,We(100),_(f),V(([u,N])=>!!N),Re(([u,N],[S])=>[N,S],[0,0]),W(([u,N])=>N-u)),d),{atBottomState:w,atBottomStateChange:c,atBottomThreshold:y,atTopStateChange:h,atTopThreshold:k,isAtBottom:l,isAtTop:i,isScrolling:f,lastJumpDueToItemResize:m,scrollDirection:g,scrollVelocity:d}},le(be)),It="top",Ht="bottom",Cr="none";function Tr(e,t,s){return typeof e=="number"?s===ut&&t===It||s===ot&&t===Ht?e:0:s===ut?t===It?e.main:e.reverse:t===Ht?e.main:e.reverse}function Ir(e,t){var s;return typeof e=="number"?e:(s=e[t])!=null?s:0}const ir=ee(([{deviation:e,fixedHeaderHeight:t,headerHeight:s,scrollTop:n,viewportHeight:o}])=>{const a=Y(),l=z(0),i=z(0),c=z(0),h=ye(T(xe($(n),$(o),$(s),$(a,dt),$(c),$(l),$(t),$(e),$(i)),W(([y,k,f,[p,w],m,g,d,u,N])=>{const S=y-u,v=g+d,x=Math.max(f-S,0);let j=Cr;const H=Ir(N,It),L=Ir(N,Ht);return p-=u,p+=f+d,w+=f+d,w-=u,p>y+v-H&&(j=ut),w<y-x+k+L&&(j=ot),j!==Cr?[Math.max(S-f-Tr(m,It,j)-H,0),S-x-d+k+Tr(m,Ht,j)+L]:null}),V(y=>y!=null),ie(dt)),[0,0]);return{increaseViewportBy:i,listBoundary:a,overscan:c,topListHeight:l,visibleRange:h}},le(be),{singleton:!0});function yn(e,t,s){if(At(t)){const n=es(e,t);return[{index:Te(t.groupOffsetTree,n)[0],offset:0,size:0},{data:s==null?void 0:s[0],index:n,offset:0,size:0}]}return[{data:s==null?void 0:s[0],index:e,offset:0,size:0}]}const Ft={bottom:0,firstItemIndex:0,items:[],offsetBottom:0,offsetTop:0,top:0,topItems:[],topListHeight:0,totalCount:0};function jt(e,t,s,n,o,a){const{lastIndex:l,lastOffset:i,lastSize:c}=o;let h=0,y=0;if(e.length>0){h=e[0].offset;const m=e[e.length-1];y=m.offset+m.size}const k=s-l,f=i+k*c+(k-1)*n,p=h,w=f-y;return{bottom:y,firstItemIndex:a,items:Hr(e,o,a),offsetBottom:w,offsetTop:h,top:p,topItems:Hr(t,o,a),topListHeight:t.reduce((m,g)=>g.size+m,0),totalCount:s}}function os(e,t,s,n,o,a){let l=0;if(s.groupIndices.length>0)for(const y of s.groupIndices){if(y-l>=e)break;l++}const i=e+l,c=ar(t,i),h=Array.from({length:i}).map((y,k)=>({data:a[k+c],index:k+c,offset:0,size:0}));return jt(h,[],i,o,s,n)}function Hr(e,t,s){if(e.length===0)return[];if(!At(t))return e.map(h=>({...h,index:h.index+s,originalIndex:h.index}));const n=e[0].index,o=e[e.length-1].index,a=[],l=Mt(t.groupOffsetTree,n,o);let i,c=0;for(const h of e){(!i||i.end<h.index)&&(i=l.shift(),c=t.groupIndices.indexOf(i.start));let y;h.index===i.start?y={index:c,type:"group"}:y={groupIndex:c,index:h.index-(c+1)+s},a.push({...y,data:h.data,offset:h.offset,originalIndex:h.index,size:h.size})}return a}const Ge=ee(([{data:e,firstItemIndex:t,gap:s,sizes:n,totalCount:o},a,{listBoundary:l,topListHeight:i,visibleRange:c},{initialTopMostItemIndex:h,scrolledToInitialItem:y},{topListHeight:k},f,{didMount:p},{recalcInProgress:w}])=>{const m=z([]),g=z(0),d=Y();P(a.topItemsIndexes,m);const u=ye(T(xe(p,w,$(c,dt),$(o),$(n),$(h),y,$(m),$(t),$(s),e),V(([x,j,,H,,,,,,,L])=>{const b=L&&L.length!==H;return x&&!j&&!b}),W(([,,[x,j],H,L,b,R,F,K,A,E])=>{const O=L,{offsetTree:X,sizeTree:ne}=O,ce=me(g);if(H===0)return{...Ft,totalCount:H};if(x===0&&j===0)return ce===0?{...Ft,totalCount:H}:os(ce,b,L,K,A,E||[]);if(se(ne))return ce>0?null:jt(yn(ar(b,H),O,E),[],H,A,O,K);const ue=[];if(F.length>0){const M=F[0],Z=F[F.length-1];let re=0;for(const I of Mt(ne,M,Z)){const q=I.value,oe=Math.max(I.start,M),fe=Math.min(I.end,Z);for(let de=oe;de<=fe;de++)ue.push({data:E==null?void 0:E[de],index:de,offset:re,size:q}),re+=q}}if(!R)return jt([],ue,H,A,O,K);const B=F.length>0?F[F.length-1]+1:0,J=on(X,x,j,B);if(J.length===0)return null;const te=H-1,je=Lt([],M=>{for(const Z of J){const re=Z.value;let I=re.offset,q=Z.start;const oe=re.size;if(re.offset<x){q+=Math.floor((x-re.offset+A)/(oe+A));const de=q-Z.start;I+=de*oe+de*A}q<B&&(I+=(B-q)*oe,q=B);const fe=Math.min(Z.end,te);for(let de=q;de<=fe&&!(I>=j);de++)M.push({data:E==null?void 0:E[de],index:de,offset:I,size:oe}),I+=oe+A}});return jt(je,ue,H,A,O,K)}),V(x=>x!==null),ie()),Ft);P(T(e,V(er),W(x=>x==null?void 0:x.length)),o),P(T(u,W(x=>x.topListHeight)),k),P(k,i),P(T(u,W(x=>[x.top,x.bottom])),l),P(T(u,W(x=>x.items)),d);const N=ke(T(u,V(({items:x})=>x.length>0),_(o,e),V(([{items:x},j])=>x[x.length-1].originalIndex===j-1),W(([,x,j])=>[x-1,j]),ie(dt),W(([x])=>x))),S=ke(T(u,We(200),V(({items:x,topItems:j})=>x.length>0&&x[0].originalIndex===j.length),W(({items:x})=>x[0].index),ie())),v=ke(T(u,V(({items:x})=>x.length>0),W(({items:x})=>{let j=0,H=x.length-1;for(;x[j].type==="group"&&j<H;)j++;for(;x[H].type==="group"&&H>j;)H--;return{endIndex:x[H].index,startIndex:x[j].index}}),ie(Jr)));return{endReached:N,initialItemCount:g,itemsRendered:d,listState:u,rangeChanged:v,startReached:S,topItemsIndexes:m,...f}},le(Ee,rs,ir,mt,xt,ft,Fe,sr),{singleton:!0}),as=ee(([{fixedFooterHeight:e,fixedHeaderHeight:t,footerHeight:s,headerHeight:n},{listState:o}])=>{const a=Y(),l=ye(T(xe(s,e,n,t,o),W(([i,c,h,y,k])=>i+c+h+y+k.offsetBottom+k.bottom)),0);return P($(l),a),{totalListHeight:l,totalListHeightChanged:a}},le(be,Ge),{singleton:!0}),bn=ee(([{viewportHeight:e},{totalListHeight:t}])=>{const s=z(!1),n=ye(T(xe(s,e,t),V(([o])=>o),W(([,o,a])=>Math.max(0,o-a)),We(0),ie()),0);return{alignToBottom:s,paddingTopAddition:n}},le(be,as),{singleton:!0});function Rr(e){return e?e==="smooth"?"smooth":"auto":!1}const vn=(e,t)=>typeof e=="function"?Rr(e(t)):t&&Rr(e),wn=ee(([{listRefresh:e,totalCount:t,fixedItemSize:s},{atBottomState:n,isAtBottom:o},{scrollToIndex:a},{scrolledToInitialItem:l},{didMount:i,propsReady:c},{log:h},{scrollingInProgress:y}])=>{const k=z(!1),f=Y();let p=null;function w(g){G(a,{align:"end",behavior:g,index:"LAST"})}Q(T(xe(T($(t),Je(1)),i),_($(k),o,l,y),W(([[g,d],u,N,S,v])=>{let x=d&&S,j="auto";return x&&(j=vn(u,N||v),x=x&&!!j),{followOutputBehavior:j,shouldFollow:x,totalCount:g}}),V(({shouldFollow:g})=>g)),({followOutputBehavior:g,totalCount:d})=>{p&&(p(),p=null),me(s)?requestAnimationFrame(()=>{me(h)("following output to ",{totalCount:d},ve.DEBUG),w(g)}):p=ze(e,()=>{me(h)("following output to ",{totalCount:d},ve.DEBUG),w(g),p=null})});function m(g){const d=ze(n,u=>{g&&!u.atBottom&&u.notAtBottomBecause==="SIZE_INCREASED"&&!p&&(me(h)("scrolling to bottom due to increased size",{},ve.DEBUG),w("auto"))});setTimeout(d,100)}return Q(T(xe($(k),t,c),V(([g,,d])=>g&&d),Re(({value:g},[,d])=>({refreshed:g===d,value:d}),{refreshed:!1,value:0}),V(({refreshed:g})=>g),_(k,t)),([,g])=>{me(l)&&m(g!==!1)}),Q(f,()=>{m(me(k)!==!1)}),Q(xe($(k),n),([g,d])=>{g&&!d.atBottom&&d.notAtBottomBecause==="VIEWPORT_HEIGHT_DECREASING"&&w("auto")}),{autoscrollToBottom:f,followOutput:k}},le(Ee,ft,xt,mt,Fe,Pe,be)),kn=ee(([{data:e,firstItemIndex:t,gap:s,sizes:n},{initialTopMostItemIndex:o},{initialItemCount:a,listState:l},{didMount:i}])=>(P(T(i,_(a),V(([,c])=>c!==0),_(o,n,t,s,e),W(([[,c],h,y,k,f,p=[]])=>os(c,h,y,k,f,p))),l),{}),le(Ee,mt,Ge,Fe),{singleton:!0}),jn=ee(([{didMount:e},{scrollTo:t},{listState:s}])=>{const n=z(0);return Q(T(e,_(n),V(([,o])=>o!==0),W(([,o])=>({top:o}))),o=>{ze(T(s,Je(1),V(a=>a.items.length>1)),()=>{requestAnimationFrame(()=>{G(t,o)})})}),{initialScrollTop:n}},le(Fe,be,Ge),{singleton:!0}),Nn=({itemBottom:e,itemTop:t,locationParams:{align:s,behavior:n,...o},viewportBottom:a,viewportTop:l})=>t<l?{...o,align:s??"start",behavior:n}:e>a?{...o,align:s??"end",behavior:n}:null,Sn=ee(([{gap:e,sizes:t,totalCount:s},{fixedFooterHeight:n,fixedHeaderHeight:o,headerHeight:a,scrollingInProgress:l,scrollTop:i,viewportHeight:c},{scrollToIndex:h}])=>{const y=Y();return P(T(y,_(t,c,s,a,o,n,i),_(e),W(([[k,f,p,w,m,g,d,u],N])=>{const{align:S,behavior:v,calculateViewLocation:x=Nn,done:j,...H}=k,L=ts(k,f,w-1),b=gt(L,f.offsetTree,N)+m+g,R=b+Te(f.sizeTree,L)[1],F=u+g,K=u+p-d,A=x({itemBottom:R,itemTop:b,locationParams:{align:S,behavior:v,...H},viewportBottom:K,viewportTop:F});return A?j&&ze(T(l,V(E=>!E),Je(me(l)?1:2)),j):j&&j(),A}),V(k=>k!==null)),h),{scrollIntoView:y}},le(Ee,be,xt,Ge,Pe),{singleton:!0}),is=ee(([{scrollVelocity:e}])=>{const t=z(!1),s=Y(),n=z(!1);return P(T(e,_(n,t,s),V(([o,a])=>!!a),W(([o,a,l,i])=>{const{enter:c,exit:h}=a;if(l){if(h(o,i))return!1}else if(c(o,i))return!0;return l}),ie()),t),Q(T(xe(t,e,s),_(n)),([[o,a,l],i])=>{o&&i&&i.change&&i.change(a,l)}),{isSeeking:t,scrollSeekConfiguration:n,scrollSeekRangeChanged:s,scrollVelocity:e}},le(ft),{singleton:!0}),lr=ee(([{scrollContainerState:e,scrollTo:t}])=>{const s=Y(),n=Y(),o=Y(),a=z(!1),l=z(void 0);return P(T(xe(s,n),W(([{scrollHeight:i,scrollTop:c,viewportHeight:h},{offsetTop:y}])=>({scrollHeight:i,scrollTop:Math.max(0,c-y),viewportHeight:h}))),e),P(T(t,_(n),W(([i,{offsetTop:c}])=>({...i,top:i.top+c}))),o),{customScrollParent:l,useWindowScroll:a,windowScrollContainerState:s,windowScrollTo:o,windowViewportRect:n}},le(be)),Cn=ee(([{sizeRanges:e,sizes:t},{headerHeight:s,scrollTop:n},{initialTopMostItemIndex:o},{didMount:a},{useWindowScroll:l,windowScrollContainerState:i,windowViewportRect:c}])=>{const h=Y(),y=z(void 0),k=z(null),f=z(null);return P(i,k),P(c,f),Q(T(h,_(t,n,l,k,f,s)),([p,w,m,g,d,u,N])=>{const S=ln(w.sizeTree);g&&d!==null&&u!==null&&(m=d.scrollTop-u.offsetTop),m-=N,p({ranges:S,scrollTop:m})}),P(T(y,V(er),W(Tn)),o),P(T(a,_(y),V(([,p])=>p!==void 0),ie(),W(([,p])=>p.ranges)),e),{getState:h,restoreStateFrom:y}},le(Ee,be,mt,Fe,lr));function Tn(e){return{align:"start",index:0,offset:e.scrollTop}}const In=ee(([{topItemsIndexes:e}])=>{const t=z(0);return P(T(t,V(s=>s>=0),W(s=>Array.from({length:s}).map((n,o)=>o))),e),{topItemCount:t}},le(Ge));function ls(e){let t=!1,s;return()=>(t||(t=!0,s=e()),s)}const Hn=ls(()=>/iP(ad|od|hone)/i.test(navigator.userAgent)&&/WebKit/i.test(navigator.userAgent)),Rn=ee(([{deviation:e,scrollBy:t,scrollingInProgress:s,scrollTop:n},{isAtBottom:o,isScrolling:a,lastJumpDueToItemResize:l,scrollDirection:i},{listState:c},{beforeUnshiftWith:h,gap:y,shiftWithOffset:k,sizes:f},{log:p},{recalcInProgress:w}])=>{const m=ke(T(c,_(l),Re(([,d,u,N],[{bottom:S,items:v,offsetBottom:x,totalCount:j},H])=>{const L=S+x;let b=0;return u===j&&d.length>0&&v.length>0&&(v[0].originalIndex===0&&d[0].originalIndex===0||(b=L-N,b!==0&&(b+=H))),[b,v,j,L]},[0,[],0,0]),V(([d])=>d!==0),_(n,i,s,o,p,w),V(([,d,u,N,,,S])=>!S&&!N&&d!==0&&u===ut),W(([[d],,,,,u])=>(u("Upward scrolling compensation",{amount:d},ve.DEBUG),d))));function g(d){d>0?(G(t,{behavior:"auto",top:-d}),G(e,0)):(G(e,0),G(t,{behavior:"auto",top:-d}))}return Q(T(m,_(e,a)),([d,u,N])=>{N&&Hn()?G(e,u-d):g(-d)}),Q(T(xe(ye(a,!1),e,w),V(([d,u,N])=>!d&&!N&&u!==0),W(([d,u])=>u),We(1)),g),P(T(k,W(d=>({top:-d}))),t),Q(T(h,_(f,y),W(([d,{groupIndices:u,lastSize:N,sizeTree:S},v])=>{function x(j){return j*(N+v)}if(u.length===0)return x(d);{let j=0;const H=ct(S,0);let L=0,b=0;for(;L<d;){L++,j+=H;let R=u.length===b+1?1/0:u[b+1]-u[b]-1;L+R>d&&(j-=H,R=d-L+1),L+=R,j+=x(R),b++}return j}})),d=>{G(e,d),requestAnimationFrame(()=>{G(t,{top:d}),requestAnimationFrame(()=>{G(e,0),G(w,!1)})})}),{deviation:e}},le(be,ft,Ge,Ee,Pe,sr)),zn=ee(([e,t,s,n,o,a,l,i,c,h])=>({...e,...t,...s,...n,...o,...a,...l,...i,...c,...h}),le(ir,kn,Fe,is,as,jn,bn,lr,Sn,Pe)),En=ee(([{data:e,defaultItemSize:t,firstItemIndex:s,fixedItemSize:n,gap:o,groupIndices:a,itemSize:l,sizeRanges:i,sizes:c,statefulTotalCount:h,totalCount:y,trackItemSizes:k},{initialItemFinalLocationReached:f,initialTopMostItemIndex:p,scrolledToInitialItem:w},m,g,d,{listState:u,topItemsIndexes:N,...S},{scrollToIndex:v},x,{topItemCount:j},{groupCounts:H},L])=>(P(S.rangeChanged,L.scrollSeekRangeChanged),P(T(L.windowViewportRect,W(b=>b.visibleHeight)),m.viewportHeight),{data:e,defaultItemHeight:t,firstItemIndex:s,fixedItemHeight:n,gap:o,groupCounts:H,initialItemFinalLocationReached:f,initialTopMostItemIndex:p,scrolledToInitialItem:w,sizeRanges:i,topItemCount:j,topItemsIndexes:N,totalCount:y,...d,groupIndices:a,itemSize:l,listState:u,scrollToIndex:v,statefulTotalCount:h,trackItemSizes:k,...S,...L,...m,sizes:c,...g}),le(Ee,mt,be,Cn,wn,Ge,xt,Rn,In,rs,zn));function Ln(e,t){const s={},n={};let o=0;const a=e.length;for(;o<a;)n[e[o]]=1,o+=1;for(const l in t)Object.hasOwn(n,l)||(s[l]=t[l]);return s}const vt=typeof document<"u"?D.useLayoutEffect:D.useEffect;function cs(e,t,s){const n=Object.keys(t.required||{}),o=Object.keys(t.optional||{}),a=Object.keys(t.methods||{}),l=Object.keys(t.events||{}),i=D.createContext({});function c(g,d){g.propsReady&&G(g.propsReady,!1);for(const u of n){const N=g[t.required[u]];G(N,d[u])}for(const u of o)if(u in d){const N=g[t.optional[u]];G(N,d[u])}g.propsReady&&G(g.propsReady,!0)}function h(g){return a.reduce((d,u)=>(d[u]=N=>{const S=g[t.methods[u]];G(S,N)},d),{})}function y(g){return l.reduce((d,u)=>(d[u]=_s(g[t.events[u]]),d),{})}const k=D.forwardRef((g,d)=>{const{children:u,...N}=g,[S]=D.useState(()=>Lt(Ks(e),j=>{c(j,N)})),[v]=D.useState(vr(y,S));vt(()=>{for(const j of l)j in N&&Q(v[j],N[j]);return()=>{Object.values(v).map(tr)}},[N,v,S]),vt(()=>{c(S,N)}),D.useImperativeHandle(d,br(h(S)));const x=s;return r.jsx(i.Provider,{value:S,children:s?r.jsx(x,{...Ln([...n,...o,...l],N),children:u}):u})}),f=g=>{const d=D.useContext(i);return D.useCallback(u=>{G(d[g],u)},[d,g])},p=g=>{const d=D.useContext(i)[g],u=D.useCallback(N=>Q(d,N),[d]);return D.useSyncExternalStore(u,()=>me(d),()=>me(d))},w=g=>{const d=D.useContext(i)[g],[u,N]=D.useState(vr(me,d));return vt(()=>Q(d,S=>{S!==u&&N(br(S))}),[d,u]),u},m=D.version.startsWith("18")?p:w;return{Component:k,useEmitter:(g,d)=>{const u=D.useContext(i)[g];vt(()=>Q(u,d),[d,u])},useEmitterValue:m,usePublisher:f}}const ds=D.createContext(void 0),gs=D.createContext(void 0),us=typeof document<"u"?D.useLayoutEffect:D.useEffect;function Ot(e){return"self"in e}function Mn(e){return"body"in e}function hs(e,t,s,n=ht,o,a){const l=D.useRef(null),i=D.useRef(null),c=D.useRef(null),h=D.useCallback(f=>{let p,w,m;const g=f.target;if(Mn(g)||Ot(g)){const u=Ot(g)?g:g.defaultView;m=a?u.scrollX:u.scrollY,p=a?u.document.documentElement.scrollWidth:u.document.documentElement.scrollHeight,w=a?u.innerWidth:u.innerHeight}else m=a?g.scrollLeft:g.scrollTop,p=a?g.scrollWidth:g.scrollHeight,w=a?g.offsetWidth:g.offsetHeight;const d=()=>{e({scrollHeight:p,scrollTop:Math.max(m,0),viewportHeight:w})};f.suppressFlushSync?d():ks.flushSync(d),i.current!==null&&(m===i.current||m<=0||m===p-w)&&(i.current=null,t(!0),c.current&&(clearTimeout(c.current),c.current=null))},[e,t,a]);D.useEffect(()=>{const f=o||l.current;return n(o||l.current),h({suppressFlushSync:!0,target:f}),f.addEventListener("scroll",h,{passive:!0}),()=>{n(null),f.removeEventListener("scroll",h)}},[l,h,s,n,o]);function y(f){const p=l.current;if(!p||(a?"offsetWidth"in p&&p.offsetWidth===0:"offsetHeight"in p&&p.offsetHeight===0))return;const w=f.behavior==="smooth";let m,g,d;Ot(p)?(g=Math.max(De(p.document.documentElement,a?"width":"height"),a?p.document.documentElement.scrollWidth:p.document.documentElement.scrollHeight),m=a?p.innerWidth:p.innerHeight,d=a?window.scrollX:window.scrollY):(g=p[a?"scrollWidth":"scrollHeight"],m=De(p,a?"width":"height"),d=p[a?"scrollLeft":"scrollTop"]);const u=g-m;if(f.top=Math.ceil(Math.max(Math.min(u,f.top),0)),ns(m,g)||f.top===d){e({scrollHeight:g,scrollTop:d,viewportHeight:m}),w&&t(!0);return}w?(i.current=f.top,c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{c.current=null,i.current=null,t(!0)},1e3)):i.current=null,a&&(f={behavior:f.behavior,left:f.top}),p.scrollTo(f)}function k(f){a&&(f={behavior:f.behavior,left:f.top}),l.current.scrollBy(f)}return{scrollByCallback:k,scrollerRef:l,scrollToCallback:y}}const Vt="-webkit-sticky",zr="sticky",cr=ls(()=>{if(typeof document>"u")return zr;const e=document.createElement("div");return e.style.position=Vt,e.style.position===Vt?Vt:zr});function xs(e){return e}const An=ee(()=>{const e=z(c=>`Item ${c}`),t=z(null),s=z(c=>`Group ${c}`),n=z({}),o=z(xs),a=z("div"),l=z(ht),i=(c,h=null)=>ye(T(n,W(y=>y[c]),ie()),h);return{components:n,computeItemKey:o,context:t,EmptyPlaceholder:i("EmptyPlaceholder"),FooterComponent:i("Footer"),GroupComponent:i("Group","div"),groupContent:s,HeaderComponent:i("Header"),HeaderFooterTag:a,ItemComponent:i("Item","div"),itemContent:e,ListComponent:i("List","div"),ScrollerComponent:i("Scroller","div"),scrollerRef:l,ScrollSeekPlaceholder:i("ScrollSeekPlaceholder"),TopItemListComponent:i("TopItemList")}}),Wn=ee(([e,t])=>({...e,...t}),le(En,An)),Dn=({height:e})=>r.jsx("div",{style:{height:e}}),Bn={overflowAnchor:"none",position:cr(),zIndex:1},ms={overflowAnchor:"none"},Pn={...ms,display:"inline-block",height:"100%"},Er=D.memo(function({showTopList:e=!1}){const t=U("listState"),s=Ne("sizeRanges"),n=U("useWindowScroll"),o=U("customScrollParent"),a=Ne("windowScrollContainerState"),l=Ne("scrollContainerState"),i=o||n?a:l,c=U("itemContent"),h=U("context"),y=U("groupContent"),k=U("trackItemSizes"),f=U("itemSize"),p=U("log"),w=Ne("gap"),m=U("horizontalDirection"),{callbackRef:g}=Xs(s,f,k,e?ht:i,p,w,o,m,U("skipAnimationFrameInResizeObserver")),[d,u]=D.useState(0);dr("deviation",A=>{d!==A&&u(A)});const N=U("EmptyPlaceholder"),S=U("ScrollSeekPlaceholder")||Dn,v=U("ListComponent"),x=U("ItemComponent"),j=U("GroupComponent"),H=U("computeItemKey"),L=U("isSeeking"),b=U("groupIndices").length>0,R=U("alignToBottom"),F=U("initialItemFinalLocationReached"),K=e?{}:{boxSizing:"border-box",...m?{display:"inline-block",height:"100%",marginLeft:d!==0?d:R?"auto":0,paddingLeft:t.offsetTop,paddingRight:t.offsetBottom,whiteSpace:"nowrap"}:{marginTop:d!==0?d:R?"auto":0,paddingBottom:t.offsetBottom,paddingTop:t.offsetTop},...F?{}:{visibility:"hidden"}};return!e&&t.totalCount===0&&N?r.jsx(N,{...pe(N,h)}):r.jsx(v,{...pe(v,h),"data-testid":e?"virtuoso-top-item-list":"virtuoso-item-list",ref:g,style:K,children:(e?t.topItems:t.items).map(A=>{const E=A.originalIndex,O=H(E+t.firstItemIndex,A.data,h);return L?C.createElement(S,{...pe(S,h),height:A.size,index:A.index,key:O,type:A.type||"item",...A.type==="group"?{}:{groupIndex:A.groupIndex}}):A.type==="group"?C.createElement(j,{...pe(j,h),"data-index":E,"data-item-index":A.index,"data-known-size":A.size,key:O,style:Bn},y(A.index,h)):C.createElement(x,{...pe(x,h),...$n(x,A.data),"data-index":E,"data-item-group-index":A.groupIndex,"data-item-index":A.index,"data-known-size":A.size,key:O,style:m?Pn:ms},b?c(A.index,A.groupIndex,A.data,h):c(A.index,A.data,h))})})}),Fn={height:"100%",outline:"none",overflowY:"auto",position:"relative",WebkitOverflowScrolling:"touch"},On={outline:"none",overflowX:"auto",position:"relative"},Wt=e=>({height:"100%",position:"absolute",top:0,width:"100%",...e?{display:"flex",flexDirection:"column"}:{}}),Vn={position:cr(),top:0,width:"100%",zIndex:1};function pe(e,t){if(typeof e!="string")return{context:t}}function $n(e,t){return{item:typeof e=="string"?void 0:t}}const Un=D.memo(function(){const e=U("HeaderComponent"),t=Ne("headerHeight"),s=U("HeaderFooterTag"),n=Ue(D.useMemo(()=>a=>{t(De(a,"height"))},[t]),!0,U("skipAnimationFrameInResizeObserver")),o=U("context");return e?r.jsx(s,{ref:n,children:r.jsx(e,{...pe(e,o)})}):null}),Gn=D.memo(function(){const e=U("FooterComponent"),t=Ne("footerHeight"),s=U("HeaderFooterTag"),n=Ue(D.useMemo(()=>a=>{t(De(a,"height"))},[t]),!0,U("skipAnimationFrameInResizeObserver")),o=U("context");return e?r.jsx(s,{ref:n,children:r.jsx(e,{...pe(e,o)})}):null});function fs({useEmitter:e,useEmitterValue:t,usePublisher:s}){return D.memo(function({children:n,style:o,...a}){const l=s("scrollContainerState"),i=t("ScrollerComponent"),c=s("smoothScrollTargetReached"),h=t("scrollerRef"),y=t("context"),k=t("horizontalDirection")||!1,{scrollByCallback:f,scrollerRef:p,scrollToCallback:w}=hs(l,c,i,h,void 0,k);return e("scrollTo",w),e("scrollBy",f),r.jsx(i,{"data-testid":"virtuoso-scroller","data-virtuoso-scroller":!0,ref:p,style:{...k?On:Fn,...o},tabIndex:0,...a,...pe(i,y),children:n})})}function ps({useEmitter:e,useEmitterValue:t,usePublisher:s}){return D.memo(function({children:n,style:o,...a}){const l=s("windowScrollContainerState"),i=t("ScrollerComponent"),c=s("smoothScrollTargetReached"),h=t("totalListHeight"),y=t("deviation"),k=t("customScrollParent"),f=t("context"),p=D.useRef(null),w=t("scrollerRef"),{scrollByCallback:m,scrollerRef:g,scrollToCallback:d}=hs(l,c,i,w,k);return us(()=>{var u;return g.current=k||((u=p.current)==null?void 0:u.ownerDocument.defaultView),()=>{g.current=null}},[g,k]),e("windowScrollTo",d),e("scrollBy",m),r.jsx(i,{ref:p,"data-virtuoso-scroller":!0,style:{position:"relative",...o,...h!==0?{height:h+y}:{}},...a,...pe(i,f),children:n})})}const _n=({children:e})=>{const t=D.useContext(ds),s=Ne("viewportHeight"),n=Ne("fixedItemHeight"),o=U("alignToBottom"),a=U("horizontalDirection"),l=D.useMemo(()=>Ur(s,c=>De(c,a?"width":"height")),[s,a]),i=Ue(l,!0,U("skipAnimationFrameInResizeObserver"));return D.useEffect(()=>{t&&(s(t.viewportHeight),n(t.itemHeight))},[t,s,n]),r.jsx("div",{"data-viewport-type":"element",ref:i,style:Wt(o),children:e})},qn=({children:e})=>{const t=D.useContext(ds),s=Ne("windowViewportRect"),n=Ne("fixedItemHeight"),o=U("customScrollParent"),a=_r(s,o,U("skipAnimationFrameInResizeObserver")),l=U("alignToBottom");return D.useEffect(()=>{t&&(n(t.itemHeight),s({offsetTop:0,visibleHeight:t.viewportHeight,visibleWidth:100}))},[t,s,n]),r.jsx("div",{"data-viewport-type":"window",ref:a,style:Wt(l),children:e})},Kn=({children:e})=>{const t=U("TopItemListComponent")||"div",s=U("headerHeight"),n={...Vn,marginTop:`${s}px`},o=U("context");return r.jsx(t,{style:n,...pe(t,o),children:e})},Yn=D.memo(function(e){const t=U("useWindowScroll"),s=U("topItemsIndexes").length>0,n=U("customScrollParent"),o=U("context"),a=n||t?Jn:Xn,l=n||t?qn:_n;return r.jsxs(a,{...e,...pe(a,o),children:[s&&r.jsx(Kn,{children:r.jsx(Er,{showTopList:!0})}),r.jsxs(l,{children:[r.jsx(Un,{}),r.jsx(Er,{}),r.jsx(Gn,{})]})]})}),{Component:Zn,useEmitter:dr,useEmitterValue:U,usePublisher:Ne}=cs(Wn,{required:{},optional:{restoreStateFrom:"restoreStateFrom",context:"context",followOutput:"followOutput",itemContent:"itemContent",groupContent:"groupContent",overscan:"overscan",increaseViewportBy:"increaseViewportBy",totalCount:"totalCount",groupCounts:"groupCounts",topItemCount:"topItemCount",firstItemIndex:"firstItemIndex",initialTopMostItemIndex:"initialTopMostItemIndex",components:"components",atBottomThreshold:"atBottomThreshold",atTopThreshold:"atTopThreshold",computeItemKey:"computeItemKey",defaultItemHeight:"defaultItemHeight",fixedItemHeight:"fixedItemHeight",itemSize:"itemSize",scrollSeekConfiguration:"scrollSeekConfiguration",headerFooterTag:"HeaderFooterTag",data:"data",initialItemCount:"initialItemCount",initialScrollTop:"initialScrollTop",alignToBottom:"alignToBottom",useWindowScroll:"useWindowScroll",customScrollParent:"customScrollParent",scrollerRef:"scrollerRef",logLevel:"logLevel",horizontalDirection:"horizontalDirection",skipAnimationFrameInResizeObserver:"skipAnimationFrameInResizeObserver"},methods:{scrollToIndex:"scrollToIndex",scrollIntoView:"scrollIntoView",scrollTo:"scrollTo",scrollBy:"scrollBy",autoscrollToBottom:"autoscrollToBottom",getState:"getState"},events:{isScrolling:"isScrolling",endReached:"endReached",startReached:"startReached",rangeChanged:"rangeChanged",atBottomStateChange:"atBottomStateChange",atTopStateChange:"atTopStateChange",totalListHeightChanged:"totalListHeightChanged",itemsRendered:"itemsRendered",groupIndices:"groupIndices"}},Yn),Xn=fs({useEmitter:dr,useEmitterValue:U,usePublisher:Ne}),Jn=ps({useEmitter:dr,useEmitterValue:U,usePublisher:Ne}),Qn=Zn;cr();const Lr={bottom:0,itemHeight:0,items:[],itemWidth:0,offsetBottom:0,offsetTop:0,top:0},eo={bottom:0,itemHeight:0,items:[{index:0}],itemWidth:0,offsetBottom:0,offsetTop:0,top:0},{ceil:Mr,floor:Rt,max:at,min:$t,round:Ar}=Math;function Wr(e,t,s){return Array.from({length:t-e+1}).map((n,o)=>({data:s===null?null:s[o+e],index:o+e}))}function to(e){return{...eo,items:e}}function wt(e,t){return e&&e.width===t.width&&e.height===t.height}function ro(e,t){return e&&e.column===t.column&&e.row===t.row}const so=ee(([{increaseViewportBy:e,listBoundary:t,overscan:s,visibleRange:n},{footerHeight:o,headerHeight:a,scrollBy:l,scrollContainerState:i,scrollTo:c,scrollTop:h,smoothScrollTargetReached:y,viewportHeight:k},f,p,{didMount:w,propsReady:m},{customScrollParent:g,useWindowScroll:d,windowScrollContainerState:u,windowScrollTo:N,windowViewportRect:S},v])=>{const x=z(0),j=z(0),H=z(Lr),L=z({height:0,width:0}),b=z({height:0,width:0}),R=Y(),F=Y(),K=z(0),A=z(null),E=z({column:0,row:0}),O=Y(),X=Y(),ne=z(!1),ce=z(0),ue=z(!0),B=z(!1),J=z(!1);Q(T(w,_(ce),V(([I,q])=>!!q)),()=>{G(ue,!1)}),Q(T(xe(w,ue,b,L,ce,B),V(([I,q,oe,fe,,de])=>I&&!q&&oe.height!==0&&fe.height!==0&&!de)),([,,,,I])=>{G(B,!0),or(1,()=>{G(R,I)}),ze(T(h),()=>{G(t,[0,0]),G(ue,!0)})}),P(T(X,V(I=>I!=null&&I.scrollTop>0),He(0)),j),Q(T(w,_(X),V(([,I])=>I!=null)),([,I])=>{I&&(G(L,I.viewport),G(b,I.item),G(E,I.gap),I.scrollTop>0&&(G(ne,!0),ze(T(h,Je(1)),q=>{G(ne,!1)}),G(c,{top:I.scrollTop})))}),P(T(L,W(({height:I})=>I)),k),P(T(xe($(L,wt),$(b,wt),$(E,(I,q)=>I&&I.column===q.column&&I.row===q.row),$(h)),W(([I,q,oe,fe])=>({gap:oe,item:q,scrollTop:fe,viewport:I}))),O),P(T(xe($(x),n,$(E,ro),$(b,wt),$(L,wt),$(A),$(j),$(ne),$(ue),$(ce)),V(([,,,,,,,I])=>!I),W(([I,[q,oe],fe,de,Oe,et,_e,,pt,Me])=>{const{column:Ae,row:tt}=fe,{height:yt,width:Dt}=de,{width:gr}=Oe;if(_e===0&&(I===0||gr===0))return Lr;if(Dt===0){const fr=ar(Me,I),ws=fr+Math.max(_e-1,0);return to(Wr(fr,ws,et))}const bt=ys(gr,Dt,Ae);let qe,Ve;pt?q===0&&oe===0&&_e>0?(qe=0,Ve=_e-1):(qe=bt*Rt((q+tt)/(yt+tt)),Ve=bt*Mr((oe+tt)/(yt+tt))-1,Ve=$t(I-1,at(Ve,bt-1)),qe=$t(Ve,at(0,qe))):(qe=0,Ve=-1);const ur=Wr(qe,Ve,et),{bottom:hr,top:xr}=Dr(Oe,fe,de,ur),mr=Mr(I/bt),vs=mr*yt+(mr-1)*tt-hr;return{bottom:hr,itemHeight:yt,items:ur,itemWidth:Dt,offsetBottom:vs,offsetTop:xr,top:xr}})),H),P(T(A,V(I=>I!==null),W(I=>I.length)),x),P(T(xe(L,b,H,E),V(([I,q,{items:oe}])=>oe.length>0&&q.height!==0&&I.height!==0),W(([I,q,{items:oe},fe])=>{const{bottom:de,top:Oe}=Dr(I,fe,q,oe);return[Oe,de]}),ie(dt)),t);const te=z(!1);P(T(h,_(te),W(([I,q])=>q||I!==0)),te);const je=ke(T(xe(H,x),V(([{items:I}])=>I.length>0),_(te),V(([[I,q],oe])=>{const fe=I.items[I.items.length-1].index===q-1;return(oe||I.bottom>0&&I.itemHeight>0&&I.offsetBottom===0&&I.items.length===q)&&fe}),W(([[,I]])=>I-1),ie())),M=ke(T($(H),V(({items:I})=>I.length>0&&I[0].index===0),He(0),ie())),Z=ke(T($(H),_(ne),V(([{items:I},q])=>I.length>0&&!q),W(([{items:I}])=>({endIndex:I[I.length-1].index,startIndex:I[0].index})),ie(Jr),We(0)));P(Z,p.scrollSeekRangeChanged),P(T(R,_(L,b,x,E),W(([I,q,oe,fe,de])=>{const Oe=ss(I),{align:et,behavior:_e,offset:pt}=Oe;let Me=Oe.index;Me==="LAST"&&(Me=fe-1),Me=at(0,Me,$t(fe-1,Me));let Ae=Jt(q,de,oe,Me);return et==="end"?Ae=Ar(Ae-q.height+oe.height):et==="center"&&(Ae=Ar(Ae-q.height/2+oe.height/2)),pt&&(Ae+=pt),{behavior:_e,top:Ae}})),c);const re=ye(T(H,W(I=>I.offsetBottom+I.bottom)),0);return P(T(S,W(I=>({height:I.visibleHeight,width:I.visibleWidth}))),L),{customScrollParent:g,data:A,deviation:K,footerHeight:o,gap:E,headerHeight:a,increaseViewportBy:e,initialItemCount:j,itemDimensions:b,overscan:s,restoreStateFrom:X,scrollBy:l,scrollContainerState:i,scrollHeight:F,scrollTo:c,scrollToIndex:R,scrollTop:h,smoothScrollTargetReached:y,totalCount:x,useWindowScroll:d,viewportDimensions:L,windowScrollContainerState:u,windowScrollTo:N,windowViewportRect:S,...p,gridState:H,horizontalDirection:J,initialTopMostItemIndex:ce,totalListHeight:re,...f,endReached:je,propsReady:m,rangeChanged:Z,startReached:M,stateChanged:O,stateRestoreInProgress:ne,...v}},le(ir,be,ft,is,Fe,lr,Pe));function ys(e,t,s){return at(1,Rt((e+s)/(Rt(t)+s)))}function Dr(e,t,s,n){const{height:o}=s;if(o===void 0||n.length===0)return{bottom:0,top:0};const a=Jt(e,t,s,n[0].index);return{bottom:Jt(e,t,s,n[n.length-1].index)+o,top:a}}function Jt(e,t,s,n){const o=ys(e.width,s.width,t.column),a=Rt(n/o),l=a*s.height+at(0,a-1)*t.row;return l>0?l+t.row:l}const no=ee(()=>{const e=z(k=>`Item ${k}`),t=z({}),s=z(null),n=z("virtuoso-grid-item"),o=z("virtuoso-grid-list"),a=z(xs),l=z("div"),i=z(ht),c=(k,f=null)=>ye(T(t,W(p=>p[k]),ie()),f),h=z(!1),y=z(!1);return P($(y),h),{components:t,computeItemKey:a,context:s,FooterComponent:c("Footer"),HeaderComponent:c("Header"),headerFooterTag:l,itemClassName:n,ItemComponent:c("Item","div"),itemContent:e,listClassName:o,ListComponent:c("List","div"),readyStateChanged:h,reportReadyState:y,ScrollerComponent:c("Scroller","div"),scrollerRef:i,ScrollSeekPlaceholder:c("ScrollSeekPlaceholder","div")}}),oo=ee(([e,t])=>({...e,...t}),le(so,no)),ao=D.memo(function(){const e=ae("gridState"),t=ae("listClassName"),s=ae("itemClassName"),n=ae("itemContent"),o=ae("computeItemKey"),a=ae("isSeeking"),l=Se("scrollHeight"),i=ae("ItemComponent"),c=ae("ListComponent"),h=ae("ScrollSeekPlaceholder"),y=ae("context"),k=Se("itemDimensions"),f=Se("gap"),p=ae("log"),w=ae("stateRestoreInProgress"),m=Se("reportReadyState"),g=Ue(D.useMemo(()=>d=>{const u=d.parentElement.parentElement.scrollHeight;l(u);const N=d.firstChild;if(N){const{height:S,width:v}=N.getBoundingClientRect();k({height:S,width:v})}f({column:Br("column-gap",getComputedStyle(d).columnGap,p),row:Br("row-gap",getComputedStyle(d).rowGap,p)})},[l,k,f,p]),!0,!1);return us(()=>{e.itemHeight>0&&e.itemWidth>0&&m(!0)},[e]),w?null:r.jsx(c,{className:t,ref:g,...pe(c,y),"data-testid":"virtuoso-item-list",style:{paddingBottom:e.offsetBottom,paddingTop:e.offsetTop},children:e.items.map(d=>{const u=o(d.index,d.data,y);return a?r.jsx(h,{...pe(h,y),height:e.itemHeight,index:d.index,width:e.itemWidth},u):C.createElement(i,{...pe(i,y),className:s,"data-index":d.index,key:u},n(d.index,d.data,y))})})}),io=D.memo(function(){const e=ae("HeaderComponent"),t=Se("headerHeight"),s=ae("headerFooterTag"),n=Ue(D.useMemo(()=>a=>{t(De(a,"height"))},[t]),!0,!1),o=ae("context");return e?r.jsx(s,{ref:n,children:r.jsx(e,{...pe(e,o)})}):null}),lo=D.memo(function(){const e=ae("FooterComponent"),t=Se("footerHeight"),s=ae("headerFooterTag"),n=Ue(D.useMemo(()=>a=>{t(De(a,"height"))},[t]),!0,!1),o=ae("context");return e?r.jsx(s,{ref:n,children:r.jsx(e,{...pe(e,o)})}):null}),co=({children:e})=>{const t=D.useContext(gs),s=Se("itemDimensions"),n=Se("viewportDimensions"),o=Ue(D.useMemo(()=>a=>{n(a.getBoundingClientRect())},[n]),!0,!1);return D.useEffect(()=>{t&&(n({height:t.viewportHeight,width:t.viewportWidth}),s({height:t.itemHeight,width:t.itemWidth}))},[t,n,s]),r.jsx("div",{ref:o,style:Wt(!1),children:e})},go=({children:e})=>{const t=D.useContext(gs),s=Se("windowViewportRect"),n=Se("itemDimensions"),o=ae("customScrollParent"),a=_r(s,o,!1);return D.useEffect(()=>{t&&(n({height:t.itemHeight,width:t.itemWidth}),s({offsetTop:0,visibleHeight:t.viewportHeight,visibleWidth:t.viewportWidth}))},[t,s,n]),r.jsx("div",{ref:a,style:Wt(!1),children:e})},uo=D.memo(function({...e}){const t=ae("useWindowScroll"),s=ae("customScrollParent"),n=s||t?xo:ho,o=s||t?go:co,a=ae("context");return r.jsx(n,{...e,...pe(n,a),children:r.jsxs(o,{children:[r.jsx(io,{}),r.jsx(ao,{}),r.jsx(lo,{})]})})}),{Component:Ro,useEmitter:bs,useEmitterValue:ae,usePublisher:Se}=cs(oo,{optional:{context:"context",totalCount:"totalCount",overscan:"overscan",itemContent:"itemContent",components:"components",computeItemKey:"computeItemKey",data:"data",initialItemCount:"initialItemCount",scrollSeekConfiguration:"scrollSeekConfiguration",headerFooterTag:"headerFooterTag",listClassName:"listClassName",itemClassName:"itemClassName",useWindowScroll:"useWindowScroll",customScrollParent:"customScrollParent",scrollerRef:"scrollerRef",logLevel:"logLevel",restoreStateFrom:"restoreStateFrom",initialTopMostItemIndex:"initialTopMostItemIndex",increaseViewportBy:"increaseViewportBy"},methods:{scrollTo:"scrollTo",scrollBy:"scrollBy",scrollToIndex:"scrollToIndex"},events:{isScrolling:"isScrolling",endReached:"endReached",startReached:"startReached",rangeChanged:"rangeChanged",atBottomStateChange:"atBottomStateChange",atTopStateChange:"atTopStateChange",stateChanged:"stateChanged",readyStateChanged:"readyStateChanged"}},uo),ho=fs({useEmitter:bs,useEmitterValue:ae,usePublisher:Se}),xo=ps({useEmitter:bs,useEmitterValue:ae,usePublisher:Se});function Br(e,t,s){return t!=="normal"&&!(t!=null&&t.endsWith("px"))&&s(`${e} was not resolved to pixel value correctly`,t,ve.WARN),t==="normal"?0:parseInt(t??"0",10)}const mo=({text:e,highlightedWords:t=[],onWordClick:s,onWordHover:n,className:o="",wordClassName:a="",highlightClassName:l="bg-blue-200 dark:bg-blue-800/50 text-blue-800 dark:text-blue-300 font-medium"})=>{const i=C.useMemo(()=>e?e.split(/(\b[\w'-]+\b)/):[],[e]),c=C.useCallback(f=>{const p=f.toLowerCase().replace(/[^a-z]/g,"");return t.includes(p)},[t]),h=C.useCallback((f,p)=>{p.stopPropagation(),s&&s(f,p)},[s]),y=C.useCallback((f,p)=>{p.target.style.transform="scale(1.05)",p.target.style.transition="all 0.15s ease",n&&n(f,p,"enter")},[n]),k=C.useCallback((f,p)=>{p.target.style.transform="scale(1)",n&&n(f,p,"leave")},[n]);return r.jsx("span",{className:o,children:i.map((f,p)=>{if(p%2===1){const m=c(f);return r.jsx("span",{className:`
                cursor-pointer 
                transition-all 
                duration-200 
                rounded 
                px-1 
                word-hover-effect
                ${m?`highlighted ${l}`:""}
                ${a}
              `,onClick:g=>h(f,g),onMouseEnter:g=>y(f,g),onMouseLeave:g=>k(f,g),title:m?"Click to remove highlight":"Click to highlight",children:f},p)}else return r.jsx("span",{children:f},p)})})},fo=({isVisible:e,position:t,selectedText:s,isHighlighted:n,onClose:o,onCopy:a,onAskAI:l,onToggleHighlight:i,onAddToWordbook:c})=>{const h=C.useRef(null);C.useEffect(()=>{if(typeof window>"u"||typeof document>"u")return;const w=m=>{h.current&&!h.current.contains(m.target)&&o()};if(e)return document.addEventListener("mousedown",w),()=>{typeof document<"u"&&document.removeEventListener("mousedown",w)}},[e,o]);const y=()=>{if(!t||typeof window>"u")return{x:0,y:0};const w=200,m=200;let{x:g,y:d}=t;return g+w>window.innerWidth&&(g=window.innerWidth-w-10),d+m>window.innerHeight&&(d=window.innerHeight-m-10),g<10&&(g=10),d<10&&(d=10),{x:g,y:d}},k=C.useCallback(w=>{w(),o()},[o]);if(!e||!s)return null;const f=y(),p=[{label:"复制",icon:Fr,action:()=>a&&a(s),className:"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"},{label:"AI解释",icon:js,action:()=>l&&l(s),className:"text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/50"},{label:n?"取消高亮":"添加高亮",icon:n?Or:Xe,action:()=>i&&i(s),className:n?"text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/50":"text-green-600 dark:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/50"}];return s.includes(" ")&&c&&p.push({label:"添加到生词本",icon:Xe,action:()=>c(s),className:"text-purple-600 dark:text-purple-400 hover:bg-purple-50 dark:hover:bg-purple-900/50"}),r.jsxs("div",{ref:h,className:"fixed z-50 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg shadow-lg py-2 min-w-[180px] max-w-[250px]",style:{left:`${f.x}px`,top:`${f.y}px`},children:[r.jsxs("div",{className:"px-3 py-2 border-b border-gray-200 dark:border-gray-600",children:[r.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"已选择:"}),r.jsxs("div",{className:"text-sm font-medium text-gray-800 dark:text-gray-200 truncate",children:['"',s.length>30?s.substring(0,30)+"...":s,'"']})]}),p.map((w,m)=>{const g=w.icon;return r.jsxs("button",{onClick:()=>k(w.action),className:`w-full flex items-center px-3 py-2 text-sm transition-colors ${w.className}`,disabled:!w.action,children:[r.jsx(g,{className:"w-4 h-4 mr-3 flex-shrink-0"}),r.jsx("span",{className:"truncate",children:w.label})]},m)}),r.jsx("div",{className:"border-t border-gray-200 dark:border-gray-600 mt-1",children:r.jsxs("button",{onClick:o,className:"w-full flex items-center px-3 py-2 text-sm text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[r.jsx(Ze,{className:"w-4 h-4 mr-3"}),"关闭"]})})]})};class po{constructor(){this.baseURL="/api/dictionary/v2/entries/en"}async getWordDefinition(t){try{const s=t.toLowerCase().replace(/[^a-z]/g,"");if(!s||s.length<1)throw new Error("Invalid word");console.log(`Fetching definition for: ${s}`);const n=`${this.baseURL}/${s}`;console.log(`Request URL: ${n}`);const o=await fetch(n,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!o.ok)return console.warn(`Dictionary API returned ${o.status} for word: ${s}`),null;const a=await o.json();return console.log("Dictionary response:",a),!Array.isArray(a)||a.length===0?(console.warn("No definition found in response"),null):this.formatResponse(a[0],s)}catch(s){return console.error("Dictionary service error:",s),null}}formatResponse(t,s){try{const n=(t.phonetics||[]).filter(a=>a.text||a.audio).map(a=>({text:a.text||"",audio:a.audio||""})),o=(t.meanings||[]).map(a=>({partOfSpeech:a.partOfSpeech||"",definitions:(a.definitions||[]).slice(0,3).map(l=>({definition:l.definition||"",example:l.example||"",synonyms:l.synonyms||[],antonyms:l.antonyms||[]})),synonyms:a.synonyms||[],antonyms:a.antonyms||[]}));return{word:t.word||s,phonetics:n,meanings:o,success:!0}}catch(n){return console.error("Error formatting response:",n),{word:s,phonetics:[],meanings:[{partOfSpeech:"",definitions:[{definition:"Definition available",example:"",synonyms:[],antonyms:[]}],synonyms:[],antonyms:[]}],success:!1}}}async batchGetDefinitions(t){const s=[];for(const n of t)try{const o=await this.getWordDefinition(n);s.push({word:n,definition:o,success:!!o}),await new Promise(a=>setTimeout(a,100))}catch(o){s.push({word:n,definition:null,success:!1,error:o.message})}return s}}const yo=new po;class bo{constructor(){this.highlightedWords=new Set,this.listeners=new Set}addHighlight(t){const s=t.toLowerCase().replace(/[^a-z]/g,"");s&&!this.highlightedWords.has(s)&&(this.highlightedWords.add(s),this.notifyListeners("add",s),console.log(`Added highlight: ${s}`))}removeHighlight(t){const s=t.toLowerCase().replace(/[^a-z]/g,"");s&&this.highlightedWords.has(s)&&(this.highlightedWords.delete(s),this.notifyListeners("remove",s),console.log(`Removed highlight: ${s}`))}toggleHighlight(t){const s=t.toLowerCase().replace(/[^a-z]/g,"");return s?this.highlightedWords.has(s)?(this.removeHighlight(s),!1):(this.addHighlight(s),!0):!1}isHighlighted(t){const s=t.toLowerCase().replace(/[^a-z]/g,"");return this.highlightedWords.has(s)}getAllHighlighted(){return Array.from(this.highlightedWords)}clearAllHighlights(){const t=Array.from(this.highlightedWords);this.highlightedWords.clear(),t.forEach(s=>this.notifyListeners("remove",s)),console.log("Cleared all highlights")}setHighlights(t){this.highlightedWords.clear(),t.forEach(s=>{const n=s.toLowerCase().replace(/[^a-z]/g,"");n&&this.highlightedWords.add(n)}),this.notifyListeners("reset",Array.from(this.highlightedWords))}addListener(t){this.listeners.add(t)}removeListener(t){this.listeners.delete(t)}notifyListeners(t,s){this.listeners.forEach(n=>{try{n(t,s)}catch(o){console.error("Error in highlight listener:",o)}})}loadFromStorage(t="highlighted-words"){try{const s=localStorage.getItem(t);if(s){const n=JSON.parse(s);Array.isArray(n)&&(this.setHighlights(n),console.log(`Loaded ${n.length} highlighted words from storage`))}}catch(s){console.error("Error loading highlights from storage:",s)}}saveToStorage(t="highlighted-words"){try{const s=this.getAllHighlighted();localStorage.setItem(t,JSON.stringify(s)),console.log(`Saved ${s.length} highlighted words to storage`)}catch(s){console.error("Error saving highlights to storage:",s)}}}const Ie=new bo,Ce=({icon:e,title:t,children:s})=>r.jsxs("div",{className:"flex items-center justify-between px-4 py-4 h-16 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-indigo-50 to-blue-50 dark:from-indigo-950/50 dark:to-blue-950/50",children:[r.jsxs("div",{className:"flex items-center min-w-0 flex-1",children:[e&&r.jsx(e,{className:"w-5 h-5 mr-3 text-indigo-600 dark:text-indigo-400 flex-shrink-0"}),r.jsx("span",{className:"text-lg font-semibold text-gray-800 dark:text-gray-200 truncate",children:t})]}),s&&r.jsx("div",{className:"flex items-center space-x-2 ml-3 flex-shrink-0",children:s})]}),Pr=({document:e,onUpdateTags:t})=>{const[s,n]=C.useState([]),[o,a]=C.useState(""),[l,i]=C.useState(!1),[c,h]=C.useState({wordCount:0,paragraphCount:0,knownWords:0,readingTime:0});C.useEffect(()=>{e&&(n(e.tags||[]),y())},[e]);const y=()=>{if(!(e!=null&&e.content))return;const w=e.content,m=w.split(/\s+/).filter(N=>N.trim().length>0),g=w.split(`
`).filter(N=>N.trim().length>0),d=e.words?e.words.size||e.words.length:0,u=Math.ceil(m.length/200);h({wordCount:m.length,paragraphCount:g.length,knownWords:d,readingTime:u})},k=()=>{if(o.trim()&&!s.includes(o.trim())){const w=[...s,o.trim()];n(w),t(e.id,w),a(""),i(!1)}},f=w=>{const m=s.filter(g=>g!==w);n(m),t(e.id,m)},p=w=>w?new Date(w).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"Unknown";return e?r.jsxs("div",{className:"flex flex-col h-full",children:[r.jsx(Ce,{icon:Le,title:"文档信息"}),r.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-3 space-y-6 custom-scrollbar",children:[r.jsxs("div",{className:"bg-gradient-to-r from-indigo-50 to-blue-50 dark:from-indigo-950/30 dark:to-blue-950/30 rounded-xl p-4 space-y-3",children:[r.jsx("h4",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200 mb-3",children:"基本信息"}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-400",children:[r.jsx(zt,{className:"w-4 h-4 mr-3 text-indigo-500"}),r.jsx("span",{className:"font-medium mr-2",children:"添加时间:"}),r.jsx("span",{children:p(e.createdAt)})]}),r.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-400",children:[r.jsx(Gt,{className:"w-4 h-4 mr-3 text-indigo-500"}),r.jsx("span",{className:"font-medium mr-2",children:"更新时间:"}),r.jsx("span",{children:p(e.updatedAt)})]})]})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("h4",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200 flex items-center",children:[r.jsx(Nt,{className:"w-4 h-4 mr-2 text-indigo-500"}),"阅读统计"]}),r.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[r.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-100 dark:border-blue-800/30",children:[r.jsxs("div",{className:"flex items-center mb-2",children:[r.jsx(Le,{className:"w-4 h-4 mr-2 text-blue-600 dark:text-blue-400"}),r.jsx("span",{className:"text-xs font-medium text-blue-800 dark:text-blue-300",children:"总词数"})]}),r.jsx("div",{className:"text-xl font-bold text-blue-900 dark:text-blue-100",children:c.wordCount.toLocaleString()})]}),r.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-xl border border-green-100 dark:border-green-800/30",children:[r.jsxs("div",{className:"flex items-center mb-2",children:[r.jsx(Gt,{className:"w-4 h-4 mr-2 text-green-600 dark:text-green-400"}),r.jsx("span",{className:"text-xs font-medium text-green-800 dark:text-green-300",children:"预计时间"})]}),r.jsxs("div",{className:"text-xl font-bold text-green-900 dark:text-green-100",children:[c.readingTime," 分钟"]})]}),r.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-xl border border-purple-100 dark:border-purple-800/30",children:[r.jsxs("div",{className:"flex items-center mb-2",children:[r.jsx(Vr,{className:"w-4 h-4 mr-2 text-purple-600 dark:text-purple-400"}),r.jsx("span",{className:"text-xs font-medium text-purple-800 dark:text-purple-300",children:"段落数"})]}),r.jsx("div",{className:"text-xl font-bold text-purple-900 dark:text-purple-100",children:c.paragraphCount})]}),r.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 p-4 rounded-xl border border-orange-100 dark:border-orange-800/30",children:[r.jsxs("div",{className:"flex items-center mb-2",children:[r.jsx(Xe,{className:"w-4 h-4 mr-2 text-orange-600 dark:text-orange-400"}),r.jsx("span",{className:"text-xs font-medium text-orange-800 dark:text-orange-300",children:"已知词汇"})]}),r.jsx("div",{className:"text-xl font-bold text-orange-900 dark:text-orange-100",children:c.knownWords})]})]}),c.wordCount>0&&r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700",children:[r.jsxs("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-400 mb-3",children:[r.jsx("span",{className:"font-medium",children:"词汇掌握进度"}),r.jsxs("span",{className:"font-bold text-indigo-600 dark:text-indigo-400",children:[Math.round(c.knownWords/c.wordCount*100),"%"]})]}),r.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3",children:r.jsx("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-500 h-3 rounded-full transition-all duration-500 shadow-sm",style:{width:`${Math.min(c.knownWords/c.wordCount*100,100)}%`}})})]})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("h4",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200 flex items-center",children:[r.jsx(Ct,{className:"w-4 h-4 mr-2 text-indigo-500"}),"标签管理"]}),r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700 space-y-3",children:[s.length>0&&r.jsx("div",{className:"flex flex-wrap gap-2",children:s.map((w,m)=>r.jsxs("span",{className:"inline-flex items-center px-3 py-1.5 text-sm font-medium bg-indigo-100 dark:bg-indigo-900/50 text-indigo-800 dark:text-indigo-300 rounded-full group border border-indigo-200 dark:border-indigo-800 transition-all duration-200 hover:shadow-sm",children:[r.jsx(Ct,{className:"w-3 h-3 mr-1.5"}),w,r.jsx("button",{onClick:()=>f(w),className:"ml-1.5 opacity-0 group-hover:opacity-100 transition-opacity",children:r.jsx(Ze,{className:"w-3 h-3 hover:text-red-500 transition-colors"})})]},m))}),l?r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("input",{type:"text",value:o,onChange:w=>a(w.target.value),onKeyPress:w=>w.key==="Enter"&&k(),placeholder:"输入标签名称",className:"flex-1 min-w-0 px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent dark:bg-gray-700 dark:text-gray-200 transition-all",style:{maxWidth:"120px"},autoFocus:!0}),r.jsx("button",{onClick:k,className:"px-3 py-2 text-sm bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors shadow-sm whitespace-nowrap",children:"添加"}),r.jsx("button",{onClick:()=>{i(!1),a("")},className:"px-3 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors border border-gray-300 dark:border-gray-600 rounded-lg hover:border-gray-400 dark:hover:border-gray-500 whitespace-nowrap",children:"取消"})]}):r.jsxs("button",{onClick:()=>i(!0),className:"inline-flex items-center px-3 py-2 text-sm text-gray-600 dark:text-gray-400 border border-dashed border-gray-300 dark:border-gray-600 rounded-lg hover:border-indigo-500 hover:text-indigo-600 dark:hover:text-indigo-400 transition-all duration-200 hover:bg-indigo-50 dark:hover:bg-indigo-950/20",children:[r.jsx(St,{className:"w-4 h-4 mr-2"}),"添加标签"]})]})]}),e.content&&r.jsxs("div",{className:"space-y-4",children:[r.jsxs("h4",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200 flex items-center",children:[r.jsx(Le,{className:"w-4 h-4 mr-2 text-indigo-500"}),"内容预览"]}),r.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700",children:r.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 leading-relaxed",children:[e.content.substring(0,300),e.content.length>300&&"..."]})})]})]})]}):r.jsxs("div",{className:"flex flex-col h-full",children:[r.jsx(Ce,{icon:Le,title:"文档信息"}),r.jsx("div",{className:"flex-1 flex items-center justify-center",children:r.jsxs("div",{className:"text-center px-4",children:[r.jsx(Le,{className:"w-16 h-16 mx-auto mb-4 text-gray-300 dark:text-gray-600"}),r.jsx("h3",{className:"text-lg font-medium text-gray-700 dark:text-gray-300 mb-2",children:"未选择文档"}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"请选择一个文档来查看其详细信息"})]})})]})},vo=({document:e,settings:t={},pendingMessage:s,onMessageProcessed:n})=>{const[o,a]=C.useState([]),[l,i]=C.useState(""),[c,h]=C.useState(!1),[y,k]=C.useState(!1),[f,p]=C.useState(!1);C.useState(!0),C.useState(null),C.useState(0);const[w,m]=C.useState(!1),[g,d]=C.useState(null),[u,N]=C.useState(""),[S,v]=C.useState(null),x=C.useRef(null),j=C.useRef(null);C.useRef(null);const H=C.useRef(null);C.useEffect(()=>{k(!!t.aiApiKey),e&&t.aiApiKey&&(a([{id:Date.now(),type:"assistant",content:`你好！我是AI助手，可以帮助你理解"${e.title}"这个文档。你可以问我关于内容、词汇或概念的任何问题。`,timestamp:new Date}]),i(""))},[e,t]),C.useEffect(()=>{s&&s.text&&(i(s.text),setTimeout(()=>{j.current&&j.current.focus()},100),n&&n())},[s,n]),C.useEffect(()=>{L()},[o]),C.useEffect(()=>{const M=Z=>{H.current&&!H.current.contains(Z.target)&&p(!1)};return f&&e.addEventListener("mousedown",M),()=>{e.removeEventListener("mousedown",M)}},[f]);const L=()=>{var M;(M=x.current)==null||M.scrollIntoView({behavior:"smooth"})},b=async()=>{if(!l.trim()||c||!y)return;const M={id:Date.now(),type:"user",content:l,timestamp:new Date};a(re=>[...re,M]);const Z=l;i(""),await ne(Z)},R=M=>{M.key==="Enter"&&!M.shiftKey&&(M.preventDefault(),b())},F=()=>{a([]),e&&t.aiApiKey&&a([{id:Date.now(),type:"assistant",content:`你好！我是AI助手，可以帮助你理解"${e.title}"这个文档。你可以问我关于内容、词汇或概念的任何问题。`,timestamp:new Date}])},K=()=>{a([]),p(!1)},A=()=>{window.location.hash="#settings/ai",p(!1)},E=()=>{m(!0),p(!1)},O=()=>e?["总结这个文档","重点内容是什么？","解释难懂的词汇","我可以问哪些问题？"]:[],X=M=>{i(M),setTimeout(()=>{const Z={id:Date.now(),type:"user",content:M,timestamp:new Date};a(re=>[...re,Z]),ne(M)},100)},ne=async M=>{h(!0);try{let Z="";if(!t.aiApiKey)await new Promise(I=>setTimeout(I,1e3)),Z=`我注意到你正在使用AI助手的演示模式。要获得完整功能，请前往"设置→AI助手"配置你的API密钥。

你的问题是: "${M}"

这是一个模拟回复，因为AI服务尚未完全配置。请在设置中添加有效的API密钥以启用完整功能。`;else{let I="";e&&(I=`Document: "${e.title}"

Content excerpt: ${e.content.substring(0,1e3)}...`),Z=await Ns.generateResponse(M,I)}const re={id:Date.now()+1,type:"assistant",content:Z,timestamp:new Date};a(I=>[...I,re])}catch(Z){console.error("AI response error:",Z);const re={id:Date.now()+1,type:"error",content:"Sorry, I encountered an error while processing your request. Please try again.",timestamp:new Date};a(I=>[...I,re])}finally{h(!1)}},ce=M=>{navigator.clipboard.writeText(M)},ue=async M=>{const Z=o[M-1];Z&&Z.type==="user"&&(a(re=>re.slice(0,M)),await ne(Z.content))},B=M=>{console.log("Adding to notes:",M)},J=(M,Z)=>{d(M),N(Z)},te=async()=>{if(!u.trim())return;a(re=>re.map(I=>I.id===g?{...I,content:u,isEdited:!0}:I));const M=o.findIndex(re=>re.id===g);o[M].type==="user"&&(a(re=>re.slice(0,M+1)),await ne(u)),d(null),N("")},je=()=>{d(null),N("")};return y?w?r.jsxs("div",{className:"flex flex-col h-full",children:[r.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100",children:"聊天历史"}),r.jsx("button",{onClick:()=>m(!1),className:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:r.jsx(Ze,{className:"w-5 h-5"})})]}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"text-center text-gray-500 dark:text-gray-400 text-sm",children:['"',(e==null?void 0:e.title)||"当前文档",'" 的聊天历史']}),r.jsxs("div",{className:"bg-white dark:bg-gray-700 rounded-xl p-4 border border-gray-200 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-600 cursor-pointer transition-colors",children:[r.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 mb-2",children:"关于文档内容的讨论"}),r.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:"2024年8月3日 14:30"}),r.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300 line-clamp-2",children:"总结这个文档的主要内容..."})]}),r.jsx("div",{className:"text-center text-gray-400 dark:text-gray-500 text-sm py-8",children:"暂无更多历史记录"})]})})]}):r.jsxs("div",{className:"flex flex-col h-full",children:[r.jsxs(Ce,{icon:_t,title:"AI助手",children:[r.jsx(nt,{onClick:F,icon:St,variant:"ghost",title:"开始新聊天"}),r.jsx(nt,{onClick:E,icon:Qt,variant:"ghost",title:"历史聊天"}),r.jsxs("div",{className:"relative",children:[r.jsx(nt,{onClick:()=>p(!f),icon:Rs,variant:"ghost",title:"设置"}),f&&r.jsxs("div",{ref:H,className:"absolute right-0 top-full mt-1 w-48 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg z-50",children:[r.jsx("button",{onClick:K,className:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-t-lg",children:"清理聊天历史"}),r.jsx("button",{onClick:A,className:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-b-lg",children:"模型设置"})]})]})]}),r.jsxs("div",{className:"flex-1 overflow-y-auto px-3 py-2 space-y-3 sidebar-scroll",children:[o.map((M,Z)=>r.jsx("div",{className:`flex ${M.type==="user"?"justify-end":"justify-start"}`,onMouseEnter:()=>v(M.id),onMouseLeave:()=>v(null),children:r.jsxs("div",{className:"relative max-w-[90%]",children:[r.jsx("div",{className:`rounded-xl px-4 py-3 shadow-sm ${M.type==="user"?"bg-indigo-600 text-white":M.type==="error"?"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300 border border-red-200 dark:border-red-800":"bg-gray-50 dark:bg-gray-700 text-gray-800 dark:text-gray-200 border border-gray-200 dark:border-gray-600"}`,children:r.jsxs("div",{className:"flex items-start space-x-3",children:[r.jsx("div",{className:"flex-shrink-0 mt-0.5",children:M.type==="user"?r.jsx(Cs,{className:"w-4 h-4 opacity-80"}):M.type==="error"?r.jsx(Ts,{className:"w-4 h-4"}):r.jsx(Bt,{className:"w-4 h-4 text-indigo-500 dark:text-indigo-400"})}),r.jsx("div",{className:"flex-1 min-w-0",children:g===M.id?r.jsxs("div",{className:"space-y-2",children:[r.jsx("textarea",{value:u,onChange:re=>N(re.target.value),className:"w-full resize-none rounded-lg border border-gray-300 dark:border-gray-600 px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-transparent dark:bg-gray-600 dark:text-gray-200",rows:"3"}),r.jsxs("div",{className:"flex space-x-2",children:[r.jsxs("button",{onClick:te,className:"flex items-center px-3 py-1 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-xs transition-colors",children:[r.jsx(zs,{className:"w-3 h-3 mr-1"}),"保存"]}),r.jsxs("button",{onClick:je,className:"flex items-center px-3 py-1 bg-gray-500 hover:bg-gray-600 text-white rounded-lg text-xs transition-colors",children:[r.jsx(Ze,{className:"w-3 h-3 mr-1"}),"取消"]})]})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"text-sm leading-relaxed whitespace-pre-wrap break-words",children:[M.content,M.isEdited&&r.jsx("span",{className:"text-xs opacity-60 ml-2",children:"(已编辑)"})]}),r.jsx("div",{className:`text-xs mt-2 opacity-60 ${M.type==="user"?"text-indigo-100":"text-gray-500 dark:text-gray-400"}`,children:M.timestamp.toLocaleTimeString()})]})})]})}),S===M.id&&g!==M.id&&r.jsxs("div",{className:`absolute -bottom-2 ${M.type==="user"?"right-0":"left-0"} flex space-x-1 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 p-1`,children:[r.jsx("button",{onClick:()=>ce(M.content),className:"p-1.5 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors",title:"复制",children:r.jsx(Fr,{className:"w-3 h-3"})}),M.type==="user"&&r.jsx("button",{onClick:()=>J(M.id,M.content),className:"p-1.5 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors",title:"编辑",children:r.jsx(Ms,{className:"w-3 h-3"})}),M.type==="assistant"&&r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:()=>ue(Z),className:"p-1.5 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors",title:"重新生成",children:r.jsx(Ws,{className:"w-3 h-3"})}),r.jsx("button",{onClick:()=>B(M.content),className:"p-1.5 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors",title:"加入笔记",children:r.jsx(Is,{className:"w-3 h-3"})})]})]})]})},M.id)),c&&r.jsx("div",{className:"flex justify-start px-3",children:r.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-xl px-4 py-3 border border-gray-200 dark:border-gray-600",children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx(Bt,{className:"w-4 h-4 text-indigo-500 dark:text-indigo-400"}),r.jsx(pr,{className:"w-4 h-4 animate-spin text-indigo-500 dark:text-indigo-400"}),r.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"正在思考..."})]})})}),r.jsx("div",{ref:x})]}),r.jsxs("div",{className:"px-4 py-3 border-t border-gray-200 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-800/50 mt-auto",children:[(o.length===0||o.length===1&&o[0].type==="assistant")&&e&&r.jsx("div",{className:"mb-3",children:r.jsx("div",{className:"flex flex-wrap gap-2",children:O().map((M,Z)=>r.jsx("button",{onClick:()=>X(M),className:"px-3 py-1.5 text-xs text-indigo-600 dark:text-indigo-400 hover:text-white hover:bg-indigo-600 dark:hover:bg-indigo-500 border border-indigo-200 dark:border-indigo-700 hover:border-indigo-600 rounded-full transition-all duration-200",children:M},Z))})}),r.jsxs("div",{className:"flex items-end space-x-3",children:[r.jsx("div",{className:"flex-1",children:r.jsx("textarea",{ref:j,value:l,onChange:M=>i(M.target.value),onKeyPress:R,placeholder:"问我任何问题...",className:"w-full resize-none rounded-xl border border-gray-300 dark:border-gray-600 px-4 py-3 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-transparent dark:bg-gray-700 dark:text-gray-200 transition-all",style:{overflow:"hidden"},disabled:c,rows:"1"})}),r.jsx("button",{onClick:b,disabled:!l.trim()||c,className:"h-[52px] w-[52px] flex items-center justify-center bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl transition-all duration-200 disabled:bg-gray-400 disabled:cursor-not-allowed shadow-sm hover:shadow-md",children:c?r.jsx(pr,{className:"w-5 h-5 animate-spin"}):r.jsx(Bs,{className:"w-5 h-5"})})]})]})]}):r.jsxs("div",{className:"flex flex-col h-full",children:[r.jsx(Ce,{icon:_t,title:"AI助手"}),r.jsx("div",{className:"flex-1 flex flex-col items-center justify-center",children:r.jsxs("div",{className:"text-center px-4",children:[r.jsx(Bt,{className:"w-16 h-16 mx-auto mb-4 text-gray-300 dark:text-gray-600"}),r.jsx("h3",{className:"text-lg font-medium text-gray-700 dark:text-gray-300 mb-2",children:"AI助手未启用"}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:"请在设置中启用AI助手功能。"}),r.jsxs("button",{onClick:()=>window.location.hash="#settings/ai",className:"inline-flex items-center px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-colors",children:[r.jsx(Ut,{className:"w-4 h-4 mr-2"}),r.jsx("span",{children:"前往AI设置"})]})]})})]})},wo=({document:e,wordbook:t})=>{const[s,n]=C.useState([]),[o,a]=C.useState([]),[l,i]=C.useState(""),[c,h]=C.useState("all"),[y,k]=C.useState("recent"),[f,p]=C.useState({totalWords:0,studiedWords:0,masteredWords:0,todayWords:0});C.useEffect(()=>{t&&e&&w()},[t,e]),C.useEffect(()=>{g()},[s,l,c,y]);const w=()=>{if(!t||!e)return;const v=(Array.isArray(t)?t:Object.values(t)).filter(x=>{var j;return(j=x.sentences)==null?void 0:j.some(H=>H.docId===e.id)}).map(x=>({...x,lookupTime:x.added||x.addedAt||new Date().toISOString(),fromDocument:e.title}));n(v),m(v)},m=S=>{const v=new Date().toDateString(),x=S.length,j=S.filter(b=>b.status==="learning"||b.status==="reviewing").length,H=S.filter(b=>b.status==="mastered").length,L=S.filter(b=>new Date(b.lookupTime).toDateString()===v).length;p({totalWords:x,studiedWords:j,masteredWords:H,todayWords:L})},g=()=>{let S=[...s];l&&(S=S.filter(v=>{var x,j;return((x=v.word)==null?void 0:x.toLowerCase().includes(l.toLowerCase()))||((j=v.definition)==null?void 0:j.toLowerCase().includes(l.toLowerCase()))})),c!=="all"&&(S=S.filter(v=>v.status===c)),S.sort((v,x)=>{switch(y){case"recent":return new Date(x.lookupTime)-new Date(v.lookupTime);case"alphabetical":return(v.word||"").localeCompare(x.word||"");case"frequency":return(x.count||0)-(v.count||0);default:return 0}}),a(S)},d=S=>{if("speechSynthesis"in window){const v=new SpeechSynthesisUtterance(S);v.lang="en-US",v.rate=.8,speechSynthesis.speak(v)}},u=S=>{switch(S){case"learning":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300";case"reviewing":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300";case"mastered":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},N=S=>new Date(S).toLocaleString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return r.jsxs("div",{className:"flex flex-col h-full",children:[r.jsx(Ce,{icon:Qt,title:"词汇记录"}),r.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-3 space-y-6 custom-scrollbar",children:[r.jsxs("div",{className:"bg-gradient-to-r from-indigo-50 to-blue-50 dark:from-indigo-950/30 dark:to-blue-950/30 rounded-xl p-4",children:[r.jsxs("h4",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200 mb-4 flex items-center",children:[r.jsx(Nt,{className:"w-4 h-4 mr-2 text-indigo-500"}),"学习统计"]}),r.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[r.jsxs("div",{className:"bg-white dark:bg-gray-800 p-3 rounded-lg border border-gray-200 dark:border-gray-700",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx(Xe,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"}),r.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"总词数"})]}),r.jsx("div",{className:"text-xl font-bold text-gray-800 dark:text-gray-200",children:f.totalWords})]}),r.jsxs("div",{className:"bg-white dark:bg-gray-800 p-3 rounded-lg border border-gray-200 dark:border-gray-700",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx(qt,{className:"w-4 h-4 text-green-600 dark:text-green-400"}),r.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"已掌握"})]}),r.jsx("div",{className:"text-xl font-bold text-gray-800 dark:text-gray-200",children:f.masteredWords})]}),r.jsxs("div",{className:"bg-white dark:bg-gray-800 p-3 rounded-lg border border-gray-200 dark:border-gray-700",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx(Nt,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400"}),r.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"学习中"})]}),r.jsx("div",{className:"text-xl font-bold text-gray-800 dark:text-gray-200",children:f.studiedWords})]}),r.jsxs("div",{className:"bg-white dark:bg-gray-800 p-3 rounded-lg border border-gray-200 dark:border-gray-700",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx(zt,{className:"w-4 h-4 text-indigo-600 dark:text-indigo-400"}),r.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"今日"})]}),r.jsx("div",{className:"text-xl font-bold text-gray-800 dark:text-gray-200",children:f.todayWords})]})]})]}),r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700 space-y-3",children:[r.jsxs("h4",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200 flex items-center",children:[r.jsx(it,{className:"w-4 h-4 mr-2 text-indigo-500"}),"搜索与过滤"]}),r.jsxs("div",{className:"relative",children:[r.jsx(it,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),r.jsx("input",{type:"text",value:l,onChange:S=>i(S.target.value),placeholder:"搜索单词或释义...",className:"w-full pl-10 pr-10 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"}),l&&r.jsx("button",{onClick:()=>i(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 hover:bg-gray-100 dark:hover:bg-gray-600 rounded-full p-1 transition-colors",children:r.jsx(Ze,{className:"w-4 h-4 text-gray-400 hover:text-gray-600"})})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[r.jsxs("select",{value:c,onChange:S=>h(S.target.value),className:"px-3 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all",children:[r.jsx("option",{value:"all",children:"所有状态"}),r.jsx("option",{value:"learning",children:"学习中"}),r.jsx("option",{value:"reviewing",children:"复习中"}),r.jsx("option",{value:"mastered",children:"已掌握"})]}),r.jsxs("select",{value:y,onChange:S=>k(S.target.value),className:"px-3 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all",children:[r.jsx("option",{value:"recent",children:"最近查看"}),r.jsx("option",{value:"alphabetical",children:"字母排序"}),r.jsx("option",{value:"frequency",children:"查看频率"})]})]})]}),r.jsx("div",{className:"space-y-3",children:o.length===0?r.jsxs("div",{className:"text-center py-12",children:[r.jsx(Xe,{className:"w-16 h-16 mx-auto mb-4 text-gray-300 dark:text-gray-600"}),r.jsx("h4",{className:"text-lg font-medium text-gray-700 dark:text-gray-300 mb-2",children:l||c!=="all"?"没有匹配的词汇":"还没有词汇记录"}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:l||c!=="all"?"尝试调整搜索条件或过滤器":"开始阅读来建立你的词汇记录"})]}):o.map((S,v)=>r.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-4 hover:shadow-md hover:border-indigo-200 dark:hover:border-indigo-700 transition-all duration-200",children:r.jsx("div",{className:"flex items-start justify-between",children:r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[r.jsx("h4",{className:"font-semibold text-lg text-gray-800 dark:text-gray-200",children:S.word}),r.jsx("span",{className:`px-3 py-1 text-xs font-medium rounded-full ${u(S.status)}`,children:S.status==="learning"?"学习中":S.status==="reviewing"?"复习中":S.status==="mastered"?"已掌握":"新词"}),r.jsx("button",{onClick:()=>d(S.word),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-600 rounded-lg transition-colors",title:"播放发音",children:r.jsx(Ke,{className:"w-4 h-4 text-gray-500 dark:text-gray-400 hover:text-indigo-500"})})]}),r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-3 leading-relaxed",children:S.definition||"暂无释义"}),r.jsxs("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400 space-x-4",children:[r.jsxs("span",{className:"flex items-center",children:[r.jsx(Gt,{className:"w-3 h-3 mr-1.5"}),N(S.lookupTime)]}),S.count&&r.jsxs("span",{children:["查看 ",S.count," 次"]})]})]})})},v))}),o.length>0&&r.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3 border border-gray-200 dark:border-gray-700",children:r.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:["显示 ",o.length," / ",s.length," 个词汇"]})})]})]})},ko=({document:e,onAddNote:t})=>{const[s,n]=C.useState([]),[o,a]=C.useState(!1),[l,i]=C.useState(null),[c,h]=C.useState({title:"",content:"",type:"general",tags:[]}),[y,k]=C.useState(""),[f,p]=C.useState("all"),w=[{id:"general",label:"常规",color:"blue"},{id:"vocabulary",label:"词汇",color:"green"},{id:"summary",label:"总结",color:"purple"},{id:"question",label:"问题",color:"orange"},{id:"insight",label:"见解",color:"pink"}];C.useEffect(()=>{e&&m()},[e]);const m=()=>{const b=localStorage.getItem(`notes_${e.id}`);n(b?JSON.parse(b):[])},g=b=>{localStorage.setItem(`notes_${e.id}`,JSON.stringify(b)),n(b)},d=()=>{if(!c.title.trim()||!c.content.trim())return;const b={id:Date.now(),...c,docId:e.id,docTitle:e.title,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},R=[...s,b];g(R),h({title:"",content:"",type:"general",tags:[]}),a(!1),t&&t(b)},u=b=>{i(b.id),h({title:b.title,content:b.content,type:b.type,tags:b.tags||[]})},N=()=>{if(!c.title.trim()||!c.content.trim())return;const b=s.map(R=>R.id===l?{...R,...c,updatedAt:new Date().toISOString()}:R);g(b),i(null),h({title:"",content:"",type:"general",tags:[]})},S=b=>{if(confirm("确定要删除这条笔记吗？")){const R=s.filter(F=>F.id!==b);g(R)}},v=()=>{i(null),a(!1),h({title:"",content:"",type:"general",tags:[]})},x=b=>{const R=w.find(F=>F.id===b);return R?R.color:"blue"},j=()=>{let b=s;return y&&(b=b.filter(R=>{var F;return R.title.toLowerCase().includes(y.toLowerCase())||R.content.toLowerCase().includes(y.toLowerCase())||((F=R.tags)==null?void 0:F.some(K=>K.toLowerCase().includes(y.toLowerCase())))})),f!=="all"&&(b=b.filter(R=>R.type===f)),b.sort((R,F)=>new Date(F.updatedAt)-new Date(R.updatedAt))},H=b=>new Date(b).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});if(!e)return r.jsxs("div",{className:"flex flex-col h-full",children:[r.jsx(Ce,{icon:st,title:"阅读笔记"}),r.jsx("div",{className:"flex-1 flex items-center justify-center",children:r.jsxs("div",{className:"text-center px-4",children:[r.jsx(st,{className:"w-16 h-16 mx-auto mb-4 text-gray-300 dark:text-gray-600"}),r.jsx("h3",{className:"text-lg font-medium text-gray-700 dark:text-gray-300 mb-2",children:"未选择文档"}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"请选择一个文档来添加阅读笔记"})]})})]});const L=j();return r.jsxs("div",{className:"flex flex-col h-full",children:[r.jsx(Ce,{icon:st,title:"阅读笔记",children:r.jsx(nt,{onClick:()=>a(!0),icon:St,variant:"ghost",title:"添加笔记"})}),r.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-3 space-y-4 sidebar-scroll",children:[r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700 space-y-3",children:[r.jsxs("div",{className:"relative",children:[r.jsx(it,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),r.jsx("input",{type:"text",value:y,onChange:b=>k(b.target.value),placeholder:"搜索笔记...",className:"w-full pl-10 pr-4 py-3 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent dark:bg-gray-700 dark:text-gray-200 transition-all"})]}),r.jsxs("select",{value:f,onChange:b=>p(b.target.value),className:"w-full px-3 py-3 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent dark:bg-gray-700 dark:text-gray-200 transition-all",children:[r.jsx("option",{value:"all",children:"所有类型"}),w.map(b=>r.jsx("option",{value:b.id,children:b.label},b.id))]})]}),(o||l)&&r.jsxs("div",{className:"bg-gradient-to-r from-indigo-50 to-blue-50 dark:from-indigo-950/30 dark:to-blue-950/30 rounded-xl p-4 border-2 border-indigo-200 dark:border-indigo-800/50",children:[r.jsxs("h4",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200 mb-4 flex items-center",children:[r.jsx(yr,{className:"w-4 h-4 mr-2 text-indigo-500"}),l?"编辑笔记":"添加新笔记"]}),r.jsxs("div",{className:"space-y-4",children:[r.jsx("input",{type:"text",value:c.title,onChange:b=>h(R=>({...R,title:b.target.value})),placeholder:"笔记标题...",className:"w-full px-4 py-3 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent dark:bg-gray-700 dark:text-gray-200 transition-all"}),r.jsx("select",{value:c.type,onChange:b=>h(R=>({...R,type:b.target.value})),className:"w-full px-4 py-3 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent dark:bg-gray-700 dark:text-gray-200 transition-all",children:w.map(b=>r.jsx("option",{value:b.id,children:b.label},b.id))}),r.jsx("textarea",{value:c.content,onChange:b=>h(R=>({...R,content:b.target.value})),placeholder:"在这里写下你的笔记...",rows:"5",className:"w-full px-4 py-3 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent dark:bg-gray-700 dark:text-gray-200 resize-none transition-all"}),r.jsxs("div",{className:"flex space-x-3",children:[r.jsxs("button",{onClick:l?N:d,className:"flex items-center px-4 py-2.5 text-sm bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-all duration-200 shadow-sm hover:shadow-md",children:[r.jsx(Hs,{className:"w-4 h-4 mr-2"}),l?"更新笔记":"保存笔记"]}),r.jsxs("button",{onClick:v,className:"flex items-center px-4 py-2.5 text-sm text-gray-600 dark:text-gray-400 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-all duration-200",children:[r.jsx(Ze,{className:"w-4 h-4 mr-2"}),"取消"]})]})]})]}),r.jsx("div",{className:"space-y-3",children:L.length===0?r.jsxs("div",{className:"text-center py-12",children:[r.jsx(st,{className:"w-16 h-16 mx-auto mb-4 text-gray-300 dark:text-gray-600"}),r.jsx("h3",{className:"text-lg font-medium text-gray-700 dark:text-gray-300 mb-2",children:"还没有笔记"}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:"添加你的第一条笔记开始记录阅读心得"}),r.jsxs("button",{onClick:()=>a(!0),className:"inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-all duration-200 shadow-sm hover:shadow-md",children:[r.jsx(St,{className:"w-4 h-4 mr-2"}),"添加笔记"]})]}):L.map(b=>{var R;return r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700 hover:shadow-md transition-all duration-200 hover:border-indigo-200 dark:hover:border-indigo-700",children:[r.jsxs("div",{className:"flex items-start justify-between mb-3",children:[r.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[r.jsx("h4",{className:"font-medium text-gray-800 dark:text-gray-200 truncate",children:b.title}),r.jsx("span",{className:`px-2.5 py-1 text-xs font-medium rounded-full bg-${x(b.type)}-100 dark:bg-${x(b.type)}-900/20 text-${x(b.type)}-800 dark:text-${x(b.type)}-300 flex-shrink-0`,children:((R=w.find(F=>F.id===b.type))==null?void 0:R.label)||b.type})]}),r.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0 ml-2",children:[r.jsx("button",{onClick:()=>u(b),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"编辑笔记",children:r.jsx(yr,{className:"w-4 h-4 text-gray-500 dark:text-gray-400"})}),r.jsx("button",{onClick:()=>S(b.id),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"删除笔记",children:r.jsx(Or,{className:"w-4 h-4 text-gray-500 dark:text-gray-400 hover:text-red-500"})})]})]}),r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4 leading-relaxed whitespace-pre-wrap",children:b.content}),r.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx(zt,{className:"w-3 h-3 mr-1.5"}),r.jsx("span",{children:H(b.updatedAt)})]}),b.createdAt!==b.updatedAt&&r.jsx("span",{className:"text-indigo-500 dark:text-indigo-400",children:"已编辑"})]})]},b.id)})}),s.length>0&&r.jsx("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:r.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600 dark:text-gray-400 bg-gray-50 dark:bg-gray-800 rounded-lg px-4 py-2",children:[r.jsxs("span",{children:["共 ",s.length," 条笔记"]}),r.jsxs("span",{children:["显示 ",L.length," 条"]})]})})]})]})},jo=({document:e})=>{const[t,s]=C.useState(!1),[n,o]=C.useState(0),[a,l]=C.useState([]),[i,c]=C.useState({speed:1,voice:"default",pitch:1,volume:.8,pauseBetweenSentences:1e3,highlightText:!0,autoRepeat:!1}),[h,y]=C.useState(!1),[k,f]=C.useState(0),[p,w]=C.useState(0),[m,g]=C.useState(0),d=C.useRef(window.speechSynthesis),u=C.useRef(null),N=C.useRef(null);C.useEffect(()=>(e!=null&&e.content&&S(),()=>{b()}),[e]),C.useEffect(()=>{a.length>0&&v()},[a,i.speed,i.pauseBetweenSentences]);const S=()=>{if(!(e!=null&&e.content))return;const O=e.content.replace(/\n+/g," ").replace(/\s+/g," ").trim().split(/[.!?]+/).map(X=>X.trim()).filter(X=>X.length>0).map(X=>X+".");l(O),o(0),f(0)},v=()=>{if(a.length===0)return;const O=a.reduce((ce,ue)=>ce+ue.split(" ").length,0)/150*60*1e3/i.speed,X=a.length*i.pauseBetweenSentences,ne=O+X;w(ne),g(ne)},x=E=>{if(E>=a.length){i.autoRepeat?(o(0),x(0)):(s(!1),o(0),f(0),g(p));return}const O=new SpeechSynthesisUtterance(a[E]);O.rate=i.speed,O.pitch=i.pitch,O.volume=i.volume;const X=d.current.getVoices();if(i.voice!=="default"&&X.length>0){const ne=X.find(ce=>ce.name===i.voice);ne&&(O.voice=ne)}O.onend=()=>{t&&(N.current=setTimeout(()=>{o(E+1),j(E+1),x(E+1)},i.pauseBetweenSentences))},O.onerror=ne=>{console.error("Speech synthesis error:",ne)},u.current=O,d.current.speak(O)},j=E=>{const O=E/a.length*100;f(O);const X=p*(1-E/a.length);g(Math.max(0,X))},H=()=>{s(!0),x(n)},L=()=>{s(!1),d.current.cancel(),N.current&&clearTimeout(N.current)},b=()=>{s(!1),d.current.cancel(),N.current&&clearTimeout(N.current),o(0),f(0),g(p)},R=()=>{if(n<a.length-1){const E=n+1;o(E),j(E),t&&(L(),setTimeout(()=>{s(!0),x(E)},100))}},F=()=>{if(n>0){const E=n-1;o(E),j(E),t&&(L(),setTimeout(()=>{s(!0),x(E)},100))}},K=()=>d.current.getVoices().filter(E=>E.lang.startsWith("en")),A=E=>{const O=Math.floor(E/6e4),X=Math.floor(E%6e4/1e3);return`${O}:${X.toString().padStart(2,"0")}`};return e?a.length===0?r.jsxs("div",{className:"flex flex-col h-full",children:[r.jsx(Ce,{icon:Ke,title:"语音模式"}),r.jsx("div",{className:"flex-1 flex items-center justify-center",children:r.jsxs("div",{className:"text-center px-4",children:[r.jsx(Le,{className:"w-16 h-16 mx-auto mb-4 text-gray-300 dark:text-gray-600"}),r.jsx("h3",{className:"text-lg font-medium text-gray-700 dark:text-gray-300 mb-2",children:"没有可朗读的内容"}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"当前文档没有文本内容"})]})})]}):r.jsxs("div",{className:"flex flex-col h-full",children:[r.jsx(Ce,{icon:Ke,title:"语音模式",children:r.jsx(nt,{onClick:()=>window.location.hash="#settings/pronunciation",icon:Ut,variant:"ghost",title:"发音设置"})}),r.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-3 space-y-6 sidebar-scroll",children:[r.jsx("div",{className:"bg-gradient-to-r from-indigo-50 to-blue-50 dark:from-indigo-950/30 dark:to-blue-950/30 rounded-xl p-4",children:r.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 flex items-center",children:[r.jsx(Le,{className:"w-4 h-4 mr-2 text-indigo-500"}),a.length," 个句子"]})}),h&&r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700 space-y-4",children:[r.jsxs("h4",{className:"font-semibold text-gray-800 dark:text-gray-200 flex items-center",children:[r.jsx(Ut,{className:"w-4 h-4 mr-2 text-indigo-500"}),"音频设置"]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"语速"}),r.jsx("input",{type:"range",min:"0.5",max:"2.0",step:"0.1",value:i.speed,onChange:E=>c(O=>({...O,speed:parseFloat(E.target.value)})),className:"w-full accent-indigo-500"}),r.jsxs("span",{className:"text-xs text-gray-500 font-medium",children:[i.speed,"x"]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"音量"}),r.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:i.volume,onChange:E=>c(O=>({...O,volume:parseFloat(E.target.value)})),className:"w-full accent-indigo-500"}),r.jsxs("span",{className:"text-xs text-gray-500 font-medium",children:[Math.round(i.volume*100),"%"]})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"语音"}),r.jsxs("select",{value:i.voice,onChange:E=>c(O=>({...O,voice:E.target.value})),className:"w-full px-3 py-2.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent dark:bg-gray-700 dark:text-gray-200 transition-all",children:[r.jsx("option",{value:"default",children:"默认语音"}),K().map((E,O)=>r.jsxs("option",{value:E.name,children:[E.name," (",E.lang,")"]},O))]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"句子间停顿 (毫秒)"}),r.jsx("input",{type:"range",min:"0",max:"3000",step:"100",value:i.pauseBetweenSentences,onChange:E=>c(O=>({...O,pauseBetweenSentences:parseInt(E.target.value)})),className:"w-full accent-indigo-500"}),r.jsxs("span",{className:"text-xs text-gray-500 font-medium",children:[i.pauseBetweenSentences,"ms"]})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("input",{type:"checkbox",id:"autoRepeat",checked:i.autoRepeat,onChange:E=>c(O=>({...O,autoRepeat:E.target.checked})),className:"mr-3 accent-indigo-500"}),r.jsx("label",{htmlFor:"autoRepeat",className:"text-sm text-gray-700 dark:text-gray-300",children:"自动重复"})]})]}),r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700 space-y-3",children:[r.jsxs("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-400",children:[r.jsxs("span",{className:"font-medium",children:["第 ",n+1," / ",a.length," 句"]}),r.jsxs("span",{className:"font-medium",children:[A(m)," 剩余"]})]}),r.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3",children:r.jsx("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-500 h-3 rounded-full transition-all duration-500 shadow-sm",style:{width:`${k}%`}})})]}),r.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-200 dark:border-gray-700",children:r.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[r.jsx("button",{onClick:F,disabled:n===0,className:"p-3 rounded-xl bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-sm hover:shadow-md",title:"上一句",children:r.jsx(Ps,{className:"w-5 h-5 text-gray-700 dark:text-gray-300"})}),r.jsx("button",{onClick:t?L:H,className:"p-4 rounded-xl bg-indigo-600 hover:bg-indigo-700 text-white transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105",title:t?"暂停":"播放",children:t?r.jsx(Ls,{className:"w-6 h-6"}):r.jsx(As,{className:"w-6 h-6"})}),r.jsx("button",{onClick:R,disabled:n===a.length-1,className:"p-3 rounded-xl bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-sm hover:shadow-md",title:"下一句",children:r.jsx(Fs,{className:"w-5 h-5 text-gray-700 dark:text-gray-300"})}),r.jsx("button",{onClick:b,className:"p-3 rounded-xl bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-all duration-200 shadow-sm hover:shadow-md",title:"停止",children:r.jsx(Ds,{className:"w-5 h-5 text-gray-700 dark:text-gray-300"})})]})}),i.highlightText&&a[n]&&r.jsxs("div",{className:"bg-gradient-to-r from-indigo-50 to-blue-50 dark:from-indigo-950/30 dark:to-blue-950/30 rounded-xl p-4 border border-indigo-200 dark:border-indigo-800/50",children:[r.jsxs("h4",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200 mb-3 flex items-center",children:[r.jsx(Ke,{className:"w-4 h-4 mr-2 text-indigo-500"}),"当前句子"]}),r.jsx("p",{className:"text-base text-gray-800 dark:text-gray-200 leading-relaxed",children:a[n]})]}),r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700",children:[r.jsxs("h4",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200 mb-4 flex items-center",children:[r.jsx(Nt,{className:"w-4 h-4 mr-2 text-indigo-500"}),"播放统计"]}),r.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-xl font-bold text-indigo-600 dark:text-indigo-400",children:A(p)}),r.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"总时长"})]}),r.jsxs("div",{className:"text-center",children:[r.jsxs("div",{className:"text-xl font-bold text-green-600 dark:text-green-400",children:[i.speed,"x"]}),r.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"播放速度"})]}),r.jsxs("div",{className:"text-center",children:[r.jsxs("div",{className:"text-xl font-bold text-purple-600 dark:text-purple-400",children:[Math.round(k),"%"]}),r.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"完成进度"})]})]})]})]})]}):r.jsxs("div",{className:"flex flex-col h-full",children:[r.jsx(Ce,{icon:Ke,title:"语音模式"}),r.jsx("div",{className:"flex-1 flex items-center justify-center",children:r.jsxs("div",{className:"text-center px-4",children:[r.jsx(Es,{className:"w-16 h-16 mx-auto mb-4 text-gray-300 dark:text-gray-600"}),r.jsx("h3",{className:"text-lg font-medium text-gray-700 dark:text-gray-300 mb-2",children:"未选择文档"}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"请选择一个文档来开始语音朗读"})]})})]})},No=({document:e,documents:t=[]})=>{const[s,n]=C.useState([]),[o,a]=C.useState(""),[l,i]=C.useState("similarity"),[c,h]=C.useState([]);C.useEffect(()=>{e&&t.length>0&&y()},[e,t]),C.useEffect(()=>{k()},[s,o,l]);const y=()=>{if(!e||!t)return;const m=e.tags||[],g=Array.from(e.words||[]),d=t.filter(u=>u.id!==e.id).map(u=>{const N=u.tags||[],S=Array.from(u.words||[]);let v=0;const x=m.filter(R=>N.includes(R));v+=x.length*3;const j=g.filter(R=>S.includes(R));v+=j.length;const H=e.title.toLowerCase().split(/\s+/),L=u.title.toLowerCase().split(/\s+/),b=H.filter(R=>R.length>3&&L.some(F=>F.includes(R)||R.includes(F)));return v+=b.length*2,{...u,similarityScore:v,commonTags:x,commonWords:j.slice(0,5),titleMatches:b}}).filter(u=>u.similarityScore>0).sort((u,N)=>N.similarityScore-u.similarityScore);n(d)},k=()=>{let m=[...s];o&&(m=m.filter(g=>{var d;return g.title.toLowerCase().includes(o.toLowerCase())||((d=g.tags)==null?void 0:d.some(u=>u.toLowerCase().includes(o.toLowerCase())))})),m.sort((g,d)=>{var u,N;switch(l){case"similarity":return d.similarityScore-g.similarityScore;case"recent":return new Date(d.updatedAt||d.createdAt)-new Date(g.updatedAt||g.createdAt);case"alphabetical":return g.title.localeCompare(d.title);case"tags":return(((u=d.commonTags)==null?void 0:u.length)||0)-(((N=g.commonTags)==null?void 0:N.length)||0);default:return d.similarityScore-g.similarityScore}}),h(m)},f=m=>{var d,u,N;const g=[];return((d=m.commonTags)==null?void 0:d.length)>0&&g.push(`${m.commonTags.length} 个共同标签`),((u=m.commonWords)==null?void 0:u.length)>0&&g.push(`${m.commonWords.length} 个相同词汇`),((N=m.titleMatches)==null?void 0:N.length)>0&&g.push("相似主题"),g.join(", ")||"相关内容"},p=m=>m?new Date(m).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"Unknown",w=m=>m>=10?{level:"high",color:"green",label:"High"}:m>=5?{level:"medium",color:"yellow",label:"Medium"}:{level:"low",color:"gray",label:"Low"};return e?r.jsxs("div",{className:"flex flex-col h-full",children:[r.jsx(Ce,{icon:rt,title:"相关文档"}),r.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-3 space-y-6 custom-scrollbar",children:[r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700 space-y-3",children:[r.jsxs("h4",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200 flex items-center",children:[r.jsx(it,{className:"w-4 h-4 mr-2 text-indigo-500"}),"搜索与筛选"]}),r.jsxs("div",{className:"relative",children:[r.jsx(it,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),r.jsx("input",{type:"text",value:o,onChange:m=>a(m.target.value),placeholder:"搜索相关文档...",className:"w-full pl-10 pr-4 py-3 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent dark:bg-gray-700 dark:text-gray-200 transition-all"})]}),r.jsxs("select",{value:l,onChange:m=>i(m.target.value),className:"w-full px-3 py-3 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent dark:bg-gray-700 dark:text-gray-200 transition-all",children:[r.jsx("option",{value:"similarity",children:"按相似度排序"}),r.jsx("option",{value:"recent",children:"最近更新"}),r.jsx("option",{value:"alphabetical",children:"字母排序"}),r.jsx("option",{value:"tags",children:"按共同标签"})]})]}),e.tags&&e.tags.length>0&&r.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-950/30 dark:to-indigo-950/30 rounded-xl p-4 border border-blue-200 dark:border-blue-800/30",children:[r.jsxs("h4",{className:"text-sm font-semibold text-blue-800 dark:text-blue-300 mb-3 flex items-center",children:[r.jsx(Ct,{className:"w-4 h-4 mr-2"}),"当前文档标签:"]}),r.jsx("div",{className:"flex flex-wrap gap-2",children:e.tags.map((m,g)=>r.jsxs("span",{className:"inline-flex items-center px-3 py-1.5 text-sm bg-blue-100 dark:bg-blue-800/50 text-blue-800 dark:text-blue-300 rounded-full border border-blue-200 dark:border-blue-700",children:[r.jsx(Vr,{className:"w-3 h-3 mr-1.5"}),m]},g))})]}),r.jsx("div",{className:"space-y-4",children:c.length===0?r.jsxs("div",{className:"text-center py-12",children:[r.jsx(rt,{className:"w-16 h-16 mx-auto mb-4 text-gray-300 dark:text-gray-600"}),r.jsx("h3",{className:"text-lg font-medium text-gray-700 dark:text-gray-300 mb-2",children:"未找到相关文档"}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"具有共同标签或相似内容的文档将显示在这里"})]}):c.map(m=>{const g=w(m.similarityScore);return r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700 hover:shadow-md hover:border-indigo-200 dark:hover:border-indigo-700 transition-all duration-200 cursor-pointer group",children:[r.jsxs("div",{className:"flex items-start justify-between mb-3",children:[r.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[r.jsx(Le,{className:"w-5 h-5 text-gray-500 dark:text-gray-400 flex-shrink-0"}),r.jsx("h4",{className:"font-semibold text-gray-800 dark:text-gray-200 truncate",children:m.title})]}),r.jsxs("div",{className:"flex items-center space-x-2 flex-shrink-0",children:[r.jsx("span",{className:`px-3 py-1 text-xs font-medium rounded-full bg-${g.color}-100 dark:bg-${g.color}-900/20 text-${g.color}-800 dark:text-${g.color}-300`,children:g.label==="High"?"高相似":g.label==="Medium"?"中等":"低相似"}),r.jsx(Ss,{className:"w-4 h-4 text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity"})]})]}),r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4 leading-relaxed",children:f(m)}),m.commonTags&&m.commonTags.length>0&&r.jsx("div",{className:"mb-3",children:r.jsx("div",{className:"flex flex-wrap gap-2",children:m.commonTags.map((d,u)=>r.jsxs("span",{className:"inline-flex items-center px-2.5 py-1 text-xs bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-300 rounded-full",children:[r.jsx(Ct,{className:"w-3 h-3 mr-1"}),d]},u))})}),m.commonWords&&m.commonWords.length>0&&r.jsxs("div",{className:"mb-4",children:[r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2 font-medium",children:"共同词汇:"}),r.jsx("div",{className:"flex flex-wrap gap-1.5",children:m.commonWords.map((d,u)=>r.jsx("span",{className:"inline-block px-2.5 py-1 text-xs bg-purple-100 dark:bg-purple-900/20 text-purple-800 dark:text-purple-300 rounded-lg",children:d},u))})]}),r.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400",children:[r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx(zt,{className:"w-3 h-3 mr-1.5"}),r.jsx("span",{children:p(m.updatedAt||m.createdAt)})]}),m.words&&r.jsxs("div",{className:"flex items-center",children:[r.jsx(Xe,{className:"w-3 h-3 mr-1.5"}),r.jsxs("span",{children:[Array.from(m.words).length," 词汇"]})]})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx(qt,{className:"w-3 h-3 mr-1.5"}),r.jsxs("span",{children:["得分: ",m.similarityScore]})]})]})]},m.id)})}),s.length>0&&r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700",children:[r.jsxs("h4",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200 mb-4 flex items-center",children:[r.jsx(qt,{className:"w-4 h-4 mr-2 text-indigo-500"}),"相关性统计"]}),r.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[r.jsxs("div",{children:[r.jsx("div",{className:"text-xl font-bold text-indigo-600 dark:text-indigo-400",children:s.filter(m=>w(m.similarityScore).level==="high").length}),r.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"高相似度"})]}),r.jsxs("div",{children:[r.jsx("div",{className:"text-xl font-bold text-green-600 dark:text-green-400",children:s.reduce((m,g)=>{var d;return m+(((d=g.commonTags)==null?void 0:d.length)||0)},0)}),r.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"共同标签"})]}),r.jsxs("div",{children:[r.jsx("div",{className:"text-xl font-bold text-purple-600 dark:text-purple-400",children:s.reduce((m,g)=>{var d;return m+(((d=g.commonWords)==null?void 0:d.length)||0)},0)}),r.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"相同词汇"})]})]})]})]})]}):r.jsxs("div",{className:"flex flex-col h-full",children:[r.jsx(Ce,{icon:rt,title:"相关文档"}),r.jsx("div",{className:"flex-1 flex items-center justify-center",children:r.jsxs("div",{className:"text-center px-4",children:[r.jsx(rt,{className:"w-16 h-16 mx-auto mb-4 text-gray-300 dark:text-gray-600"}),r.jsx("h3",{className:"text-lg font-medium text-gray-700 dark:text-gray-300 mb-2",children:"未选择文档"}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"请选择一个文档来查找相关内容"})]})})]})},So=({document:e,wordbook:t,onAddNote:s,onUpdateTags:n,documents:o=[],settings:a={},askAIRequest:l,onAskAIRequestProcessed:i,onToggleSidebar:c,isExpanded:h,onExpandedChange:y})=>{var x;const[k,f]=C.useState("info"),[p,w]=C.useState(null),[m,g]=C.useState(!1),d=h!==void 0?h:m;C.useEffect(()=>{l&&(f("ai"),w(l),h!==void 0&&y?y(!0):g(!0),i&&i())},[l,i,h,y]);const u=[{id:"info",label:"文档信息",labelEn:"Document Info",icon:Le,component:Pr},{id:"ai",label:"AI助手",labelEn:"AI Assistant",icon:_t,component:vo},{id:"history",label:"词汇记录",labelEn:"Word History",icon:Qt,component:wo},{id:"notes",label:"阅读笔记",labelEn:"Reading Notes",icon:st,component:ko},{id:"audio",label:"语音模式",labelEn:"Audio Mode",icon:Ke,component:jo},{id:"related",label:"相关文档",labelEn:"Related Docs",icon:rt,component:No}],N=((x=u.find(j=>j.id===k))==null?void 0:x.component)||Pr;u.find(j=>j.id===k),C.useCallback(()=>{h!==void 0&&y?y(!0):g(!0)},[h,y]);const S=C.useCallback(()=>{h!==void 0&&y?y(!1):g(!1)},[h,y]),v=C.useCallback(j=>{f(j),d||(h!==void 0&&y?y(!0):g(!0))},[d,h,y]);return C.useEffect(()=>{if(typeof window>"u"||typeof e>"u"||typeof e.addEventListener!="function")return;const j=H=>{H.key==="Escape"&&d&&(H.preventDefault(),S())};return e.addEventListener("keydown",j),()=>e.removeEventListener("keydown",j)},[d,S]),C.useEffect(()=>{if(typeof window>"u"){console.warn("RightSidebar: window is undefined, skipping browser-specific setup");return}},[]),r.jsxs("div",{className:"fixed right-0 top-[73px] h-[calc(100vh-73px)] z-30 flex",children:[r.jsx("div",{className:`bg-white/95 dark:bg-gray-800/95 backdrop-blur-sm border-l border-gray-200 dark:border-gray-700 shadow-xl transition-all duration-300 ease-in-out overflow-hidden ${d?"w-80 opacity-100 translate-x-0":"w-0 opacity-0 translate-x-full"}`,children:d&&r.jsx(r.Fragment,{children:r.jsx("div",{className:"flex-1 overflow-y-auto sidebar-scroll",children:r.jsx(N,{document:e,wordbook:t,onAddNote:s,onUpdateTags:n,documents:o,settings:a,pendingMessage:k==="ai"?p:null,onMessageProcessed:()=>w(null)})})})}),r.jsx("div",{className:"w-16 bg-white/95 dark:bg-gray-800/95 backdrop-blur-sm border-l border-gray-200 dark:border-gray-700 shadow-lg flex flex-col",children:r.jsxs("div",{className:"flex-1 py-4 space-y-2 relative",children:[u.map((j,H)=>{const L=j.icon,b=k===j.id;return r.jsx("div",{className:"px-2 relative",children:r.jsx("button",{onClick:()=>v(j.id),className:`w-12 h-12 flex items-center justify-center rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 relative ${b?"bg-indigo-100 dark:bg-indigo-900/50 text-indigo-600 dark:text-indigo-300 shadow-md scale-105":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-indigo-500 hover:scale-105"}`,title:j.label,"aria-label":j.label,"aria-pressed":b,children:r.jsx(L,{className:"w-5 h-5"})})},j.id)}),r.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-8 bg-gradient-to-t from-white/50 to-transparent dark:from-gray-800/50 pointer-events-none"})]})})]})},zo=({doc:e,knownWords:t=[],wordbook:s={},onWordToggle:n,documents:o=[],settings:a={},onAskAI:l,askAIRequest:i,onAskAIRequestProcessed:c,isSidebarVisible:h=!0,onToggleSidebar:y,isSidebarExpanded:k=!1,onSidebarExpandedChange:f})=>{const[p,w]=C.useState([]),[m,g]=C.useState([]),[d,u]=C.useState({isVisible:!1,position:{x:0,y:0},selectedText:"",isHighlighted:!1});C.useCallback(()=>{y&&y()},[y]);const[N,S]=C.useState(null),[v,x]=C.useState(!1);C.useEffect(()=>{if(!e||!e.content){w([]);return}const B=e.content.split(`
`).filter(J=>J.trim().length>0);w(B)},[e]),C.useEffect(()=>{t&&t.length>0&&Ie.setHighlights(t);const B=(J,te)=>{g(Ie.getAllHighlighted())};return Ie.addListener(B),g(Ie.getAllHighlighted()),()=>{Ie.removeListener(B)}},[t]);const j=C.useCallback(async B=>{console.log("Word clicked:",B);try{const J=Ie.toggleHighlight(B);if(J){console.log("Getting definition for:",B);const te=await yo.getWordDefinition(B);te?console.log("Definition found:",te):console.log("No definition found, word still highlighted")}n&&n(B,"",!J)}catch(J){console.error("Error handling word click:",J)}},[n]),H=C.useCallback(B=>{const J=window.getSelection(),te=J.toString().trim();if(te&&te.length>0){const je=J.getRangeAt(0).getBoundingClientRect(),M=Ie.isHighlighted(te);u({isVisible:!0,position:{x:je.left+je.width/2,y:je.bottom+10},selectedText:te,isHighlighted:M})}},[]),L=C.useCallback(B=>{x(!1);const J=setTimeout(()=>{x(!0),H(B)},500);S(J)},[H]),b=C.useCallback(()=>{N&&(clearTimeout(N),S(null))},[N]),R=C.useCallback(B=>{B.preventDefault();const te=window.getSelection().toString().trim();te&&te.length>0&&Ie.isHighlighted(te)&&u({isVisible:!0,position:{x:B.clientX,y:B.clientY},selectedText:te,isHighlighted:!0})},[]),F=C.useCallback(B=>{navigator.clipboard.writeText(B).then(()=>{console.log("Text copied:",B)}).catch(J=>{console.error("Failed to copy text:",J)})},[]),K=C.useCallback(B=>{l&&l(`请解释这个词或短语: "${B}"`)},[l]),A=C.useCallback(B=>{Ie.toggleHighlight(B)},[]),E=C.useCallback(B=>{Ie.addHighlight(B),n&&n(B,"")},[n]),O=C.useCallback(()=>{u(B=>({...B,isVisible:!1}))},[]),X=C.useCallback(B=>{console.log("Adding note:",B)},[]),ne=C.useCallback(B=>{console.log("Updating tags:",B)},[]),ce=C.useMemo(()=>({paragraph:B,index:J})=>r.jsx("div",{className:"mb-4 last:mb-0 select-text",onMouseUp:H,onContextMenu:R,onTouchStart:L,onTouchEnd:b,children:r.jsx(mo,{text:B,highlightedWords:m,onWordClick:j,className:"text-lg leading-relaxed"})},J),[m,j,H,R,L,b]),ue=C.useCallback(B=>r.jsx(ce,{paragraph:p[B],index:B}),[p,ce]);return e?r.jsxs("div",{className:"relative h-full",children:[r.jsx("div",{className:`transition-all duration-300 ease-in-out ${h?k?"pr-96":"pr-16":"pr-0"}`,children:r.jsx("div",{className:"max-w-4xl mx-auto p-4",children:r.jsx("div",{className:"bg-white dark:bg-gray-800 p-8 sm:p-12 rounded-lg shadow-lg",children:r.jsx("div",{className:"text-gray-700 dark:text-gray-300 font-serif",children:p.length>100?r.jsx(Qn,{totalCount:p.length,itemContent:ue,className:"virtuoso-scroller",style:{height:"calc(100vh - 250px)"},overscan:20}):p.map((B,J)=>r.jsx(ce,{paragraph:B,index:J},J))})})})}),h&&r.jsx(So,{document:e,wordbook:s,onAddNote:X,onUpdateTags:ne,documents:o,settings:a,askAIRequest:i,onAskAIRequestProcessed:c,onToggleSidebar:y,isExpanded:k,onExpandedChange:f}),r.jsx(fo,{isVisible:d.isVisible,position:d.position,selectedText:d.selectedText,isHighlighted:d.isHighlighted,onClose:O,onCopy:F,onAskAI:K,onToggleHighlight:A,onAddToWordbook:E})]}):r.jsx("div",{className:"flex items-center justify-center h-full text-gray-500 dark:text-gray-400",children:"选择一个文档开始阅读"})};export{zo as default};
